{"ast":null,"code":"import _objectSpread from\"C:/Users/Fadhi/Downloads/Essentials/ai_maker/dragflow-nn-builder/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useRef,useEffect,useCallback}from'react';import InputLayer from'../layers/InputLayer';import Conv2DLayer from'../layers/Conv2DLayer';import OutputLayer from'../layers/OutputLayer';import ConcatLayer from'../layers/ConcatLayer';import LinearLayer from'../layers/LinearLayer';import FlattenLayer from'../layers/FlattenLayer';import MaxPoolLayer from'../layers/MaxPoolLayer';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const layerComponentMap={InputLayer:InputLayer,Conv2DLayer:Conv2DLayer,OutputLayer:OutputLayer,ConcatLayer:ConcatLayer,LinearLayer:LinearLayer,FlattenLayer:FlattenLayer,MaxPoolLayer:MaxPoolLayer};const defaultParams={InputLayer:{inputShape:[28,28,1]},Conv2DLayer:{filterSize:3,numFilters:32,activationFunction:'relu'},OutputLayer:{outputShape:[10],activationFunction:'softmax'},ConcatLayer:{layers:[]},LinearLayer:{inputSize:128,outputSize:64,bias:true,activation:'relu'},FlattenLayer:{startDim:1,endDim:-1},MaxPoolLayer:{poolSize:2,stride:2,padding:'valid'}};const Canvas=/*#__PURE__*/React.forwardRef((props,ref)=>{const[layers,setLayers]=useState([]);const[connections,setConnections]=useState([]);const[draggedId,setDraggedId]=useState(null);const[dragOffset,setDragOffset]=useState({x:0,y:0});const[connecting,setConnecting]=useState({from:null,to:null});const[selectedLayerId,setSelectedLayerId]=useState(null);const[connectionPreview,setConnectionPreview]=useState(null);const[nearbyHandle,setNearbyHandle]=useState(null);// Canvas transform state\nconst[canvasTransform,setCanvasTransform]=useState({x:0,y:0,scale:1});const[isPanning,setIsPanning]=useState(false);const[panStart,setPanStart]=useState({x:0,y:0});const canvasRef=useRef(null);const contentRef=useRef(null);// Keyboard event handler for deleting selected nodes\nuseEffect(()=>{const handleKeyDown=e=>{// Don't delete if user is typing in an input field\nconst activeElement=document.activeElement;if(activeElement instanceof HTMLInputElement||activeElement instanceof HTMLTextAreaElement||activeElement instanceof HTMLSelectElement){return;}if((e.key==='Delete'||e.key==='Backspace')&&selectedLayerId!==null){// Remove the selected layer\nsetLayers(prev=>prev.filter(l=>l.id!==selectedLayerId));// Remove all connections involving this layer\nsetConnections(prev=>prev.filter(conn=>conn.from!==selectedLayerId&&conn.to!==selectedLayerId));setSelectedLayerId(null);e.preventDefault();}};document.addEventListener('keydown',handleKeyDown);return()=>document.removeEventListener('keydown',handleKeyDown);},[selectedLayerId]);// Zoom and pan controls - reduced sensitivity\nconst handleWheel=useCallback(e=>{// Only call preventDefault if needed and if it's not a passive listener\nif(e.cancelable){e.preventDefault();}if(!canvasRef.current)return;const rect=canvasRef.current.getBoundingClientRect();const mouseX=e.clientX-rect.left;const mouseY=e.clientY-rect.top;// Reduced sensitivity: changed from -0.01 to -0.001\nconst delta=e.deltaY*-0.001;const scaleFactor=Math.max(0.1,Math.min(3,canvasTransform.scale+delta));// Calculate new position to zoom towards mouse position\nconst newX=mouseX-(mouseX-canvasTransform.x)*(scaleFactor/canvasTransform.scale);const newY=mouseY-(mouseY-canvasTransform.y)*(scaleFactor/canvasTransform.scale);setCanvasTransform({x:newX,y:newY,scale:scaleFactor});},[canvasTransform]);const handlePanStart=useCallback(e=>{// Only start panning if middle mouse button or space + left click\nif(e.button===1||e.button===0&&e.ctrlKey){e.preventDefault();setIsPanning(true);setPanStart({x:e.clientX-canvasTransform.x,y:e.clientY-canvasTransform.y});}},[canvasTransform]);const handlePanMove=useCallback(e=>{if(isPanning){e.preventDefault();setCanvasTransform(prev=>_objectSpread(_objectSpread({},prev),{},{x:e.clientX-panStart.x,y:e.clientY-panStart.y}));}},[isPanning,panStart]);const handlePanEnd=useCallback(()=>{setIsPanning(false);},[]);// Reset zoom and pan\nconst resetTransform=useCallback(()=>{setCanvasTransform({x:0,y:0,scale:1});},[]);// Convert screen coordinates to canvas coordinates\nconst screenToCanvas=useCallback((screenX,screenY)=>{return{x:(screenX-canvasTransform.x)/canvasTransform.scale,y:(screenY-canvasTransform.y)/canvasTransform.scale};},[canvasTransform]);// Convert canvas coordinates to screen coordinates\nconst canvasToScreen=useCallback((canvasX,canvasY)=>{return{x:canvasX*canvasTransform.scale+canvasTransform.x,y:canvasY*canvasTransform.scale+canvasTransform.y};},[canvasTransform]);// Add new layer at the mouse drop position - fixed for transforms\nconst handleDrop=layer=>{// Only allow valid LayerType\nif(!['InputLayer','Conv2DLayer','OutputLayer','ConcatLayer','LinearLayer','FlattenLayer','MaxPoolLayer'].includes(layer.type)){return;}const validLayerTypes=['InputLayer','Conv2DLayer','OutputLayer','ConcatLayer','LinearLayer','FlattenLayer','MaxPoolLayer'];const type=validLayerTypes.find(t=>t===layer.type);if(!type){return;}// Convert drop position to canvas coordinates if provided\nlet dropX=100;let dropY=100;if(layer.x!==undefined&&layer.y!==undefined){const canvasCoords=screenToCanvas(layer.x,layer.y);dropX=canvasCoords.x;dropY=canvasCoords.y;}setLayers(prev=>[...prev,_objectSpread(_objectSpread({},layer),{},{type:type,parameters:_objectSpread({},defaultParams[type]),x:dropX,y:dropY})]);};// Improved drag logic with input element detection and selection\nconst handleMouseDown=(id,e)=>{// Prevent dragging if clicking on input elements, labels, or select elements\nconst target=e.target;if(target instanceof HTMLInputElement||target instanceof HTMLLabelElement||target instanceof HTMLSelectElement){return;}// Don't start dragging if we're connecting or panning\nif(connecting.from!==null||isPanning){return;}// Set selected layer\nsetSelectedLayerId(id);if(!canvasRef.current)return;const layer=layers.find(l=>l.id===id);if(!layer)return;const rect=canvasRef.current.getBoundingClientRect();const screenX=e.clientX-rect.left;const screenY=e.clientY-rect.top;const canvasCoords=screenToCanvas(screenX,screenY);// Calculate offset from mouse position to layer's top-left corner\nconst offsetX=canvasCoords.x-layer.x;const offsetY=canvasCoords.y-layer.y;setDraggedId(id);setDragOffset({x:offsetX,y:offsetY});e.stopPropagation();};// Click outside to deselect\nconst handleCanvasClick=e=>{if(e.target===canvasRef.current){setSelectedLayerId(null);}};const handleMouseUp=()=>{setDraggedId(null);setDragOffset({x:0,y:0});handlePanEnd();// End connection if we're connecting\nif(connecting.from!==null){setConnecting({from:null,to:null});setConnectionPreview(null);setNearbyHandle(null);}};const handleMouseMove=e=>{if(!canvasRef.current)return;const rect=canvasRef.current.getBoundingClientRect();const screenX=e.clientX-rect.left;const screenY=e.clientY-rect.top;const canvasCoords=screenToCanvas(screenX,screenY);// Handle panning\nhandlePanMove(e);// Handle node dragging\nif(draggedId!==null&&!isPanning){const x=canvasCoords.x-dragOffset.x;const y=canvasCoords.y-dragOffset.y;setLayers(prev=>prev.map(l=>l.id===draggedId?_objectSpread(_objectSpread({},l),{},{x,y}):l));}// Handle connection preview\nif(connecting.from!==null){const fromLayer=layers.find(l=>l.id===connecting.from);if(fromLayer){const fromPos=getHandlePosition(fromLayer,'output');const fromScreen=canvasToScreen(fromPos.x,fromPos.y);// Check for nearby input handles\nlet closestHandle=null;let minDistance=30;// Snap distance\nlayers.forEach(layer=>{if(layer.id!==connecting.from){const inputPos=getHandlePosition(layer,'input');const inputScreen=canvasToScreen(inputPos.x,inputPos.y);const distance=Math.sqrt(Math.pow(screenX-inputScreen.x,2)+Math.pow(screenY-inputScreen.y,2));if(distance<minDistance){minDistance=distance;closestHandle=layer.id;}}});setNearbyHandle(closestHandle);// Set preview line (in screen coordinates for SVG)\nif(closestHandle){const targetLayer=layers.find(l=>l.id===closestHandle);if(targetLayer){const targetPos=getHandlePosition(targetLayer,'input');const targetScreen=canvasToScreen(targetPos.x,targetPos.y);setConnectionPreview({from:fromScreen,to:targetScreen});}}else{setConnectionPreview({from:fromScreen,to:{x:screenX,y:screenY}});}}}};// Inline parameter editing with proper type conversion\nconst handleParamChange=(id,param,value)=>{setLayers(prev=>prev.map(l=>{if(l.id===id){let convertedValue=value;// Convert numeric strings to numbers\nif(!isNaN(Number(value))&&value.trim()!==''){convertedValue=Number(value);}// Handle array inputs (for inputShape, outputShape)\nif(param.includes('Shape')&&typeof value==='string'){try{// Parse comma-separated values as array\nconvertedValue=value.split(',').map(v=>Number(v.trim())).filter(v=>!isNaN(v));}catch(_unused){convertedValue=value;}}return _objectSpread(_objectSpread({},l),{},{parameters:_objectSpread(_objectSpread({},l.parameters),{},{[param]:convertedValue})});}return l;}));};// Connection logic with handles\nconst handleConnectionStart=(id,type,e)=>{console.log('Connection start:',{id,type});// Debug log\ne.preventDefault();e.stopPropagation();if(type==='output'){setConnecting({from:id,to:null});console.log('Started connecting from node:',id);// Debug log\n}};const handleConnectionEnd=(id,type,e)=>{console.log('Connection end:',{id,type,connectingFrom:connecting.from});// Debug log\ne.preventDefault();e.stopPropagation();if(type==='input'&&connecting.from!==null&&connecting.from!==id){// Check if connection already exists\nconst existingConnectionIndex=connections.findIndex(conn=>conn.from===connecting.from&&conn.to===id);if(existingConnectionIndex!==-1){// Disconnect if connection exists\nconsole.log('Removing existing connection');// Debug log\nsetConnections(prev=>prev.filter((_,index)=>index!==existingConnectionIndex));}else{// Connect if no connection exists\nconsole.log('Creating new connection from',connecting.from,'to',id);// Debug log\nconst fromId=connecting.from;setConnections(prev=>[...prev,{from:fromId,to:id}]);}}// Always clear connection state\nsetConnecting({from:null,to:null});setConnectionPreview(null);setNearbyHandle(null);};// Function to get all model data for export\nconst getModelData=()=>{return{layers:layers.map(layer=>({id:layer.id,type:layer.type,parameters:layer.parameters,position:{x:layer.x,y:layer.y}})),connections:connections.map(connection=>({from:connection.from,to:connection.to}))};};// Expose the getModelData function via ref\nReact.useImperativeHandle(ref,()=>({getModelData}));// Function to update node width after render - optimized to prevent infinite loops\nconst updateNodeWidth=useCallback((layerId,element)=>{if(element){const currentWidth=element.offsetWidth;// Only update if width has actually changed\nsetLayers(prev=>{const existingLayer=prev.find(layer=>layer.id===layerId);if(existingLayer&&existingLayer.width!==currentWidth){return prev.map(layer=>layer.id===layerId?_objectSpread(_objectSpread({},layer),{},{width:currentWidth}):layer);}return prev;});}},[]);// Use useEffect to measure width after initial render instead of ref callback\nuseEffect(()=>{layers.forEach(layer=>{if(!layer.width){const element=document.querySelector(\"[data-layer-id=\\\"\".concat(layer.id,\"\\\"]\"));if(element&&element instanceof HTMLDivElement){const width=element.offsetWidth;setLayers(prev=>prev.map(l=>l.id===layer.id?_objectSpread(_objectSpread({},l),{},{width}):l));}}});},[layers.length]);// Only run when number of layers changes\n// Helper function to get handle positions - using actual width\nconst getHandlePosition=(layer,type)=>{if(type==='input'){return{x:layer.x-8,y:layer.y+50};}else{const nodeWidth=layer.width||270;return{x:layer.x+nodeWidth+8,y:layer.y+50};}};// Update connection line positions to connect handles\nconst getLayerCenter=layer=>{return{x:layer.x+60,y:layer.y+50};};// Updated render connections to use screen coordinates\nconst renderConnections=()=>{const connectionLines=connections.map((connection,index)=>{const fromLayer=layers.find(l=>l.id===connection.from);const toLayer=layers.find(l=>l.id===connection.to);if(!fromLayer||!toLayer)return null;const from=getHandlePosition(fromLayer,'output');const to=getHandlePosition(toLayer,'input');const fromScreen=canvasToScreen(from.x,from.y);const toScreen=canvasToScreen(to.x,to.y);return/*#__PURE__*/_jsx(\"line\",{x1:fromScreen.x,y1:fromScreen.y,x2:toScreen.x,y2:toScreen.y,stroke:\"#007acc\",strokeWidth:2,markerEnd:\"url(#arrowhead)\"},\"connection-\".concat(index));});// Add preview connection\nconst previewLine=connectionPreview&&/*#__PURE__*/_jsx(\"line\",{x1:connectionPreview.from.x,y1:connectionPreview.from.y,x2:connectionPreview.to.x,y2:connectionPreview.to.y,stroke:nearbyHandle?\"#4caf50\":\"#ffa726\",strokeWidth:2,strokeDasharray:\"5,5\",markerEnd:\"url(#previewArrowhead)\"},\"preview\");return/*#__PURE__*/_jsxs(\"svg\",{style:{position:'absolute',top:0,left:0,width:'100%',height:'100%',pointerEvents:'none',zIndex:15// Higher than canvas content but lower than handles\n},children:[/*#__PURE__*/_jsxs(\"defs\",{children:[/*#__PURE__*/_jsx(\"marker\",{id:\"arrowhead\",markerWidth:\"10\",markerHeight:\"7\",refX:\"9\",refY:\"3.5\",orient:\"auto\",children:/*#__PURE__*/_jsx(\"polygon\",{points:\"0 0, 10 3.5, 0 7\",fill:\"#007acc\"})}),/*#__PURE__*/_jsx(\"marker\",{id:\"previewArrowhead\",markerWidth:\"10\",markerHeight:\"7\",refX:\"9\",refY:\"3.5\",orient:\"auto\",children:/*#__PURE__*/_jsx(\"polygon\",{points:\"0 0, 10 3.5, 0 7\",fill:nearbyHandle?\"#4caf50\":\"#ffa726\"})})]}),connectionLines,previewLine]});};return/*#__PURE__*/_jsxs(\"div\",{className:\"canvas\",ref:canvasRef,style:{height:'100%',// Change from minHeight to height for full expansion\nwidth:'100%',border:'1px solid #000000ff',position:'relative',overflow:'hidden',backgroundColor:'#171717ff',cursor:isPanning?'grabbing':connecting.from!==null?'crosshair':'default'},onWheel:handleWheel,onMouseDown:handlePanStart,onMouseMove:handleMouseMove,onMouseUp:handleMouseUp,onClick:handleCanvasClick,onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault();try{var _canvasRef$current;const data=e.dataTransfer.getData('text/plain');const layer=JSON.parse(data);// Calculate drop position relative to canvas\nconst rect=(_canvasRef$current=canvasRef.current)===null||_canvasRef$current===void 0?void 0:_canvasRef$current.getBoundingClientRect();if(rect){const x=e.clientX-rect.left;const y=e.clientY-rect.top;handleDrop(_objectSpread(_objectSpread({},layer),{},{x:x-60,y:y-50}));}}catch(error){console.error('Failed to parse dropped data:',error);}},tabIndex:0,children:[/*#__PURE__*/_jsxs(\"div\",{style:{position:'absolute',top:10,right:10,zIndex:200,display:'flex',flexDirection:'column',gap:5,background:'#0b0b0bff',padding:8,borderRadius:7,border:'1px solid #555'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setCanvasTransform(prev=>_objectSpread(_objectSpread({},prev),{},{scale:Math.min(3,prev.scale*1.2)})),style:{background:'#3a3a3a',border:'1px solid #555',color:'#fff',padding:'4px 8px',borderRadius:2,cursor:'pointer'},children:\"+\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setCanvasTransform(prev=>_objectSpread(_objectSpread({},prev),{},{scale:Math.max(0.1,prev.scale/1.2)})),style:{background:'#3a3a3a',border:'1px solid #555',color:'#fff',padding:'4px 8px',borderRadius:2,cursor:'pointer'},children:\"-\"}),/*#__PURE__*/_jsx(\"button\",{onClick:resetTransform,style:{background:'#3a3a3a',border:'1px solid #555',color:'#fff',padding:'4px 8px',borderRadius:2,cursor:'pointer',fontSize:10},children:\"Reset\"}),/*#__PURE__*/_jsxs(\"div\",{style:{color:'#ccc',fontSize:10,textAlign:'center'},children:[Math.round(canvasTransform.scale*100),\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{position:'absolute',bottom:10,left:10,color:'#888',fontSize:11,background:'rgba(45, 45, 45, 0.8)',padding:'4px 8px',borderRadius:4,zIndex:200},children:[\"Scroll to zoom \\u2022 Ctrl+Click or Middle-click to pan\",/*#__PURE__*/_jsx(\"br\",{}),\"Click red dot then green dot to connect nodes\"]}),/*#__PURE__*/_jsx(\"div\",{ref:contentRef,style:{transform:\"translate(\".concat(canvasTransform.x,\"px, \").concat(canvasTransform.y,\"px) scale(\").concat(canvasTransform.scale,\")\"),transformOrigin:'0 0',position:'absolute',width:'100%',height:'100%',zIndex:10,pointerEvents:'auto'},children:layers.map(layer=>{const LayerComponent=layerComponentMap[layer.type];if(!LayerComponent)return null;const isSelected=selectedLayerId===layer.id;const isConnecting=connecting.from===layer.id;const isNearbyTarget=nearbyHandle===layer.id;// Inline parameter editing UI for demo\nconst paramInputs=Object.keys(layer.parameters).map(param=>{const value=layer.parameters[param];const displayValue=Array.isArray(value)?value.join(', '):String(value);return/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:4},children:[/*#__PURE__*/_jsxs(\"label\",{style:{fontSize:12,color:'#ccc'},children:[param,\": \"]}),/*#__PURE__*/_jsx(\"input\",{style:{fontSize:12,width:80,backgroundColor:'#3a3a3a',border:'1px solid #555',color:'#ffffff',padding:'2px 4px',borderRadius:'2px'},value:displayValue,onChange:e=>handleParamChange(layer.id,param,e.target.value),placeholder:param.includes('Shape')?\"e.g. 28, 28, 1\":\"\",onMouseDown:e=>e.stopPropagation(),onFocus:e=>e.stopPropagation()})]},param);});return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',left:layer.x-8,top:layer.y+42,width:16,height:16,backgroundColor:isNearbyTarget?'#81c784':'#4caf50',borderRadius:'50%',border:'2px solid #ffffff',cursor:'pointer',zIndex:100,boxShadow:isNearbyTarget?'0 0 8px rgba(129, 199, 132, 0.8)':'0 2px 4px rgba(0, 0, 0, 0.3)',transform:isNearbyTarget?'scale(1.2)':'scale(1)',transition:'all 0.2s ease',pointerEvents:'auto'},onMouseDown:e=>{console.log('Input handle mouse down');// Debug log\nhandleConnectionStart(layer.id,'input',e);},onMouseUp:e=>{console.log('Input handle mouse up');// Debug log\nhandleConnectionEnd(layer.id,'input',e);},onClick:e=>{console.log('Input handle clicked');// Debug log\ne.preventDefault();e.stopPropagation();},title:\"Input - Click to connect from another node's output\"}),/*#__PURE__*/_jsxs(\"div\",{\"data-layer-id\":layer.id,style:{position:'absolute',left:layer.x,top:layer.y,background:isConnecting?'#1e3a5f':isSelected?'#3a3a3a':'#2d2d2d',border:isConnecting?'2px solid #007acc':isSelected?'2px solid #ff6b6b':'2px solid #555',borderRadius:8,padding:12,minWidth:120,cursor:connecting.from!==null?'crosshair':isPanning?'grabbing':'move',zIndex:draggedId===layer.id?80:30,// Below handles\ncolor:'#ffffff',boxShadow:isSelected?'0 0 10px rgba(255, 107, 107, 0.3)':'0 2px 8px rgba(0, 0, 0, 0.3)',userSelect:'none',WebkitUserSelect:'none',MozUserSelect:'none',msUserSelect:'none',pointerEvents:'auto'},onMouseDown:e=>handleMouseDown(layer.id,e),children:[/*#__PURE__*/_jsx(LayerComponent,_objectSpread({},layer.parameters)),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:8,userSelect:'none'},children:paramInputs})]}),/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',left:layer.x+(layer.width||270)+8,top:layer.y+42,width:16,height:16,backgroundColor:'#f44336',borderRadius:'50%',border:'2px solid #ffffff',cursor:'pointer',zIndex:100,boxShadow:connecting.from===layer.id?'0 0 8px rgba(244, 67, 54, 0.8)':'0 2px 4px rgba(0, 0, 0, 0.3)',transform:connecting.from===layer.id?'scale(1.2)':'scale(1)',transition:'all 0.2s ease',pointerEvents:'auto'},onMouseDown:e=>{console.log('Output handle mouse down');// Debug log\nhandleConnectionStart(layer.id,'output',e);},onMouseUp:e=>{console.log('Output handle mouse up');// Debug log\nhandleConnectionEnd(layer.id,'output',e);},onClick:e=>{console.log('Output handle clicked');// Debug log\ne.preventDefault();e.stopPropagation();},title:\"Output - Click and drag to connect to another node's output\"})]},layer.id);})}),renderConnections()]});});export default Canvas;","map":{"version":3,"names":["React","useState","useRef","useEffect","useCallback","InputLayer","Conv2DLayer","OutputLayer","ConcatLayer","LinearLayer","FlattenLayer","MaxPoolLayer","jsx","_jsx","jsxs","_jsxs","layerComponentMap","defaultParams","inputShape","filterSize","numFilters","activationFunction","outputShape","layers","inputSize","outputSize","bias","activation","startDim","endDim","poolSize","stride","padding","Canvas","forwardRef","props","ref","setLayers","connections","setConnections","draggedId","setDraggedId","dragOffset","setDragOffset","x","y","connecting","setConnecting","from","to","selectedLayerId","setSelectedLayerId","connectionPreview","setConnectionPreview","nearbyHandle","setNearbyHandle","canvasTransform","setCanvasTransform","scale","isPanning","setIsPanning","panStart","setPanStart","canvasRef","contentRef","handleKeyDown","e","activeElement","document","HTMLInputElement","HTMLTextAreaElement","HTMLSelectElement","key","prev","filter","l","id","conn","preventDefault","addEventListener","removeEventListener","handleWheel","cancelable","current","rect","getBoundingClientRect","mouseX","clientX","left","mouseY","clientY","top","delta","deltaY","scaleFactor","Math","max","min","newX","newY","handlePanStart","button","ctrlKey","handlePanMove","_objectSpread","handlePanEnd","resetTransform","screenToCanvas","screenX","screenY","canvasToScreen","canvasX","canvasY","handleDrop","layer","includes","type","validLayerTypes","find","t","dropX","dropY","undefined","canvasCoords","parameters","handleMouseDown","target","HTMLLabelElement","offsetX","offsetY","stopPropagation","handleCanvasClick","handleMouseUp","handleMouseMove","map","fromLayer","fromPos","getHandlePosition","fromScreen","closestHandle","minDistance","forEach","inputPos","inputScreen","distance","sqrt","pow","targetLayer","targetPos","targetScreen","handleParamChange","param","value","convertedValue","isNaN","Number","trim","split","v","_unused","handleConnectionStart","console","log","handleConnectionEnd","connectingFrom","existingConnectionIndex","findIndex","_","index","fromId","getModelData","position","connection","useImperativeHandle","updateNodeWidth","layerId","element","currentWidth","offsetWidth","existingLayer","width","querySelector","concat","HTMLDivElement","length","nodeWidth","getLayerCenter","renderConnections","connectionLines","toLayer","toScreen","x1","y1","x2","y2","stroke","strokeWidth","markerEnd","previewLine","strokeDasharray","style","height","pointerEvents","zIndex","children","markerWidth","markerHeight","refX","refY","orient","points","fill","className","border","overflow","backgroundColor","cursor","onWheel","onMouseDown","onMouseMove","onMouseUp","onClick","onDragOver","onDrop","_canvasRef$current","data","dataTransfer","getData","JSON","parse","error","tabIndex","right","display","flexDirection","gap","background","borderRadius","color","fontSize","textAlign","round","bottom","transform","transformOrigin","LayerComponent","isSelected","isConnecting","isNearbyTarget","paramInputs","Object","keys","displayValue","Array","isArray","join","String","marginBottom","onChange","placeholder","onFocus","boxShadow","transition","title","minWidth","userSelect","WebkitUserSelect","MozUserSelect","msUserSelect","marginTop"],"sources":["C:/Users/Fadhi/Downloads/Essentials/ai_maker/dragflow-nn-builder/src/components/canvas/Canvas.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from 'react';\nimport InputLayer from '../layers/InputLayer';\nimport Conv2DLayer from '../layers/Conv2DLayer';\nimport OutputLayer from '../layers/OutputLayer';\nimport ConcatLayer from '../layers/ConcatLayer';\nimport LinearLayer from '../layers/LinearLayer';\nimport FlattenLayer from '../layers/FlattenLayer';\nimport MaxPoolLayer from '../layers/MaxPoolLayer';\n\ntype LayerType = 'InputLayer' | 'Conv2DLayer' | 'OutputLayer' | 'ConcatLayer' | 'LinearLayer' | 'FlattenLayer' | 'MaxPoolLayer';\n\ninterface LayerProps {\n    [key: string]: any;\n}\n\nconst layerComponentMap: Record<LayerType, React.ComponentType<LayerProps>> = {\n    InputLayer: InputLayer,\n    Conv2DLayer: Conv2DLayer,\n    OutputLayer: OutputLayer,\n    ConcatLayer: ConcatLayer,\n    LinearLayer: LinearLayer,\n    FlattenLayer: FlattenLayer,\n    MaxPoolLayer: MaxPoolLayer,\n};\n\nconst defaultParams: Record<LayerType, Record<string, any>> = {\n    InputLayer: { inputShape: [28, 28, 1] },\n    Conv2DLayer: { filterSize: 3, numFilters: 32, activationFunction: 'relu' },\n    OutputLayer: { outputShape: [10], activationFunction: 'softmax' },\n    ConcatLayer: { layers: [] },\n    LinearLayer: { inputSize: 128, outputSize: 64, bias: true, activation: 'relu' },\n    FlattenLayer: { startDim: 1, endDim: -1 },\n    MaxPoolLayer: { poolSize: 2, stride: 2, padding: 'valid' },\n};\n\ninterface DroppedLayer {\n    type: LayerType;\n    id: number;\n    parameters: Record<string, any>;\n    x: number;\n    y: number;\n    selected?: boolean;\n    width?: number; // Add width property\n}\n\ninterface Connection {\n    from: number;\n    to: number;\n}\n\nconst Canvas = React.forwardRef<{getModelData: () => any}, React.PropsWithChildren<{}>>((props, ref) => {\n    const [layers, setLayers] = useState<DroppedLayer[]>([]);\n    const [connections, setConnections] = useState<Connection[]>([]);\n    const [draggedId, setDraggedId] = useState<number | null>(null);\n    const [dragOffset, setDragOffset] = useState<{ x: number; y: number }>({ x: 0, y: 0 });\n    const [connecting, setConnecting] = useState<{ from: number | null, to: number | null }>({ from: null, to: null });\n    const [selectedLayerId, setSelectedLayerId] = useState<number | null>(null);\n    const [connectionPreview, setConnectionPreview] = useState<{ from: { x: number; y: number }, to: { x: number; y: number } } | null>(null);\n    const [nearbyHandle, setNearbyHandle] = useState<number | null>(null);\n    \n    // Canvas transform state\n    const [canvasTransform, setCanvasTransform] = useState({ \n        x: 0, \n        y: 0, \n        scale: 1 \n    });\n    const [isPanning, setIsPanning] = useState(false);\n    const [panStart, setPanStart] = useState({ x: 0, y: 0 });\n    \n    const canvasRef = useRef<HTMLDivElement>(null);\n    const contentRef = useRef<HTMLDivElement>(null);\n\n    // Keyboard event handler for deleting selected nodes\n    useEffect(() => {\n        const handleKeyDown = (e: KeyboardEvent) => {\n            // Don't delete if user is typing in an input field\n            const activeElement = document.activeElement;\n            if (activeElement instanceof HTMLInputElement || \n                activeElement instanceof HTMLTextAreaElement || \n                activeElement instanceof HTMLSelectElement) {\n                return;\n            }\n\n            if ((e.key === 'Delete' || e.key === 'Backspace') && selectedLayerId !== null) {\n                // Remove the selected layer\n                setLayers(prev => prev.filter(l => l.id !== selectedLayerId));\n                // Remove all connections involving this layer\n                setConnections(prev => prev.filter(\n                    conn => conn.from !== selectedLayerId && conn.to !== selectedLayerId\n                ));\n                setSelectedLayerId(null);\n                e.preventDefault();\n            }\n        };\n\n        document.addEventListener('keydown', handleKeyDown);\n        return () => document.removeEventListener('keydown', handleKeyDown);\n    }, [selectedLayerId]);\n\n    // Zoom and pan controls - reduced sensitivity\n    const handleWheel = useCallback((e: React.WheelEvent) => {\n        // Only call preventDefault if needed and if it's not a passive listener\n        if (e.cancelable) {\n            e.preventDefault();\n        }\n        \n        if (!canvasRef.current) return;\n        \n        const rect = canvasRef.current.getBoundingClientRect();\n        const mouseX = e.clientX - rect.left;\n        const mouseY = e.clientY - rect.top;\n        \n        // Reduced sensitivity: changed from -0.01 to -0.001\n        const delta = e.deltaY * -0.001;\n        const scaleFactor = Math.max(0.1, Math.min(3, canvasTransform.scale + delta));\n        \n        // Calculate new position to zoom towards mouse position\n        const newX = mouseX - (mouseX - canvasTransform.x) * (scaleFactor / canvasTransform.scale);\n        const newY = mouseY - (mouseY - canvasTransform.y) * (scaleFactor / canvasTransform.scale);\n        \n        setCanvasTransform({\n            x: newX,\n            y: newY,\n            scale: scaleFactor\n        });\n    }, [canvasTransform]);\n\n    const handlePanStart = useCallback((e: React.MouseEvent) => {\n        // Only start panning if middle mouse button or space + left click\n        if (e.button === 1 || (e.button === 0 && e.ctrlKey)) {\n            e.preventDefault();\n            setIsPanning(true);\n            setPanStart({ x: e.clientX - canvasTransform.x, y: e.clientY - canvasTransform.y });\n        }\n    }, [canvasTransform]);\n\n    const handlePanMove = useCallback((e: React.MouseEvent) => {\n        if (isPanning) {\n            e.preventDefault();\n            setCanvasTransform(prev => ({\n                ...prev,\n                x: e.clientX - panStart.x,\n                y: e.clientY - panStart.y\n            }));\n        }\n    }, [isPanning, panStart]);\n\n    const handlePanEnd = useCallback(() => {\n        setIsPanning(false);\n    }, []);\n\n    // Reset zoom and pan\n    const resetTransform = useCallback(() => {\n        setCanvasTransform({ x: 0, y: 0, scale: 1 });\n    }, []);\n\n    // Convert screen coordinates to canvas coordinates\n    const screenToCanvas = useCallback((screenX: number, screenY: number) => {\n        return {\n            x: (screenX - canvasTransform.x) / canvasTransform.scale,\n            y: (screenY - canvasTransform.y) / canvasTransform.scale\n        };\n    }, [canvasTransform]);\n\n    // Convert canvas coordinates to screen coordinates\n    const canvasToScreen = useCallback((canvasX: number, canvasY: number) => {\n        return {\n            x: canvasX * canvasTransform.scale + canvasTransform.x,\n            y: canvasY * canvasTransform.scale + canvasTransform.y\n        };\n    }, [canvasTransform]);\n\n    // Add new layer at the mouse drop position - fixed for transforms\n    const handleDrop = (layer: { type: string; id: number; x?: number; y?: number }) => {\n        // Only allow valid LayerType\n        if (!['InputLayer', 'Conv2DLayer', 'OutputLayer', 'ConcatLayer', 'LinearLayer', 'FlattenLayer', 'MaxPoolLayer'].includes(layer.type)) {\n            return;\n        }\n        \n        const validLayerTypes: LayerType[] = ['InputLayer', 'Conv2DLayer', 'OutputLayer', 'ConcatLayer', 'LinearLayer', 'FlattenLayer', 'MaxPoolLayer'];\n        const type = validLayerTypes.find(t => t === layer.type);\n        \n        if (!type) {\n            return;\n        }\n\n        // Convert drop position to canvas coordinates if provided\n        let dropX = 100;\n        let dropY = 100;\n        \n        if (layer.x !== undefined && layer.y !== undefined) {\n            const canvasCoords = screenToCanvas(layer.x, layer.y);\n            dropX = canvasCoords.x;\n            dropY = canvasCoords.y;\n        }\n        \n        setLayers(prev => [\n            ...prev,\n            {\n                ...layer,\n                type: type,\n                parameters: { ...defaultParams[type] },\n                x: dropX,\n                y: dropY,\n            },\n        ]);\n    };\n\n    // Improved drag logic with input element detection and selection\n    const handleMouseDown = (id: number, e: React.MouseEvent) => {\n        // Prevent dragging if clicking on input elements, labels, or select elements\n        const target = e.target;\n        if (target instanceof HTMLInputElement || \n            target instanceof HTMLLabelElement || \n            target instanceof HTMLSelectElement) {\n            return;\n        }\n\n        // Don't start dragging if we're connecting or panning\n        if (connecting.from !== null || isPanning) {\n            return;\n        }\n\n        // Set selected layer\n        setSelectedLayerId(id);\n\n        if (!canvasRef.current) return;\n        \n        const layer = layers.find(l => l.id === id);\n        if (!layer) return;\n        \n        const rect = canvasRef.current.getBoundingClientRect();\n        const screenX = e.clientX - rect.left;\n        const screenY = e.clientY - rect.top;\n        const canvasCoords = screenToCanvas(screenX, screenY);\n        \n        // Calculate offset from mouse position to layer's top-left corner\n        const offsetX = canvasCoords.x - layer.x;\n        const offsetY = canvasCoords.y - layer.y;\n        \n        setDraggedId(id);\n        setDragOffset({ x: offsetX, y: offsetY });\n        e.stopPropagation();\n    };\n\n    // Click outside to deselect\n    const handleCanvasClick = (e: React.MouseEvent) => {\n        if (e.target === canvasRef.current) {\n            setSelectedLayerId(null);\n        }\n    };\n\n    const handleMouseUp = () => {\n        setDraggedId(null);\n        setDragOffset({ x: 0, y: 0 });\n        handlePanEnd();\n        \n        // End connection if we're connecting\n        if (connecting.from !== null) {\n            setConnecting({ from: null, to: null });\n            setConnectionPreview(null);\n            setNearbyHandle(null);\n        }\n    };\n\n    const handleMouseMove = (e: React.MouseEvent) => {\n        if (!canvasRef.current) return;\n        \n        const rect = canvasRef.current.getBoundingClientRect();\n        const screenX = e.clientX - rect.left;\n        const screenY = e.clientY - rect.top;\n        const canvasCoords = screenToCanvas(screenX, screenY);\n\n        // Handle panning\n        handlePanMove(e);\n\n        // Handle node dragging\n        if (draggedId !== null && !isPanning) {\n            const x = canvasCoords.x - dragOffset.x;\n            const y = canvasCoords.y - dragOffset.y;\n            setLayers(prev => prev.map(l => l.id === draggedId ? { ...l, x, y } : l));\n        }\n\n        // Handle connection preview\n        if (connecting.from !== null) {\n            const fromLayer = layers.find(l => l.id === connecting.from);\n            if (fromLayer) {\n                const fromPos = getHandlePosition(fromLayer, 'output');\n                const fromScreen = canvasToScreen(fromPos.x, fromPos.y);\n                \n                // Check for nearby input handles\n                let closestHandle: number | null = null;\n                let minDistance = 30; // Snap distance\n                \n                layers.forEach(layer => {\n                    if (layer.id !== connecting.from) {\n                        const inputPos = getHandlePosition(layer, 'input');\n                        const inputScreen = canvasToScreen(inputPos.x, inputPos.y);\n                        const distance = Math.sqrt(\n                            Math.pow(screenX - inputScreen.x, 2) + Math.pow(screenY - inputScreen.y, 2)\n                        );\n                        \n                        if (distance < minDistance) {\n                            minDistance = distance;\n                            closestHandle = layer.id;\n                        }\n                    }\n                });\n                \n                setNearbyHandle(closestHandle);\n                \n                // Set preview line (in screen coordinates for SVG)\n                if (closestHandle) {\n                    const targetLayer = layers.find(l => l.id === closestHandle);\n                    if (targetLayer) {\n                        const targetPos = getHandlePosition(targetLayer, 'input');\n                        const targetScreen = canvasToScreen(targetPos.x, targetPos.y);\n                        setConnectionPreview({\n                            from: fromScreen,\n                            to: targetScreen\n                        });\n                    }\n                } else {\n                    setConnectionPreview({\n                        from: fromScreen,\n                        to: { x: screenX, y: screenY }\n                    });\n                }\n            }\n        }\n    };\n\n    // Inline parameter editing with proper type conversion\n    const handleParamChange = (id: number, param: string, value: string) => {\n        setLayers(prev => prev.map(l => {\n            if (l.id === id) {\n                let convertedValue: any = value;\n                \n                // Convert numeric strings to numbers\n                if (!isNaN(Number(value)) && value.trim() !== '') {\n                    convertedValue = Number(value);\n                }\n                \n                // Handle array inputs (for inputShape, outputShape)\n                if (param.includes('Shape') && typeof value === 'string') {\n                    try {\n                        // Parse comma-separated values as array\n                        convertedValue = value.split(',').map(v => Number(v.trim())).filter(v => !isNaN(v));\n                    } catch {\n                        convertedValue = value;\n                    }\n                }\n                \n                return { ...l, parameters: { ...l.parameters, [param]: convertedValue } };\n            }\n            return l;\n        }));\n    };\n\n    // Connection logic with handles\n    const handleConnectionStart = (id: number, type: 'input' | 'output', e: React.MouseEvent) => {\n        console.log('Connection start:', { id, type }); // Debug log\n        e.preventDefault();\n        e.stopPropagation();\n        \n        if (type === 'output') {\n            setConnecting({ from: id, to: null });\n            console.log('Started connecting from node:', id); // Debug log\n        }\n    };\n\n    const handleConnectionEnd = (id: number, type: 'input' | 'output', e: React.MouseEvent) => {\n        console.log('Connection end:', { id, type, connectingFrom: connecting.from }); // Debug log\n        e.preventDefault();\n        e.stopPropagation();\n        \n        if (type === 'input' && connecting.from !== null && connecting.from !== id) {\n            // Check if connection already exists\n            const existingConnectionIndex = connections.findIndex(\n                conn => conn.from === connecting.from && conn.to === id\n            );\n            \n            if (existingConnectionIndex !== -1) {\n                // Disconnect if connection exists\n                console.log('Removing existing connection'); // Debug log\n                setConnections(prev => prev.filter((_, index) => index !== existingConnectionIndex));\n            } else {\n                // Connect if no connection exists\n                console.log('Creating new connection from', connecting.from, 'to', id); // Debug log\n                const fromId: number = connecting.from;\n                setConnections(prev => [...prev, { from: fromId, to: id }]);\n            }\n        }\n        \n        // Always clear connection state\n        setConnecting({ from: null, to: null });\n        setConnectionPreview(null);\n        setNearbyHandle(null);\n    };\n\n    // Function to get all model data for export\n    const getModelData = () => {\n        return {\n            layers: layers.map(layer => ({\n                id: layer.id,\n                type: layer.type,\n                parameters: layer.parameters,\n                position: { x: layer.x, y: layer.y }\n            })),\n            connections: connections.map(connection => ({\n                from: connection.from,\n                to: connection.to\n            }))\n        };\n    };\n    \n    // Expose the getModelData function via ref\n    React.useImperativeHandle(ref, () => ({\n        getModelData\n    }));\n    \n    // Function to update node width after render - optimized to prevent infinite loops\n    const updateNodeWidth = useCallback((layerId: number, element: HTMLDivElement | null) => {\n        if (element) {\n            const currentWidth = element.offsetWidth;\n            \n            // Only update if width has actually changed\n            setLayers(prev => {\n                const existingLayer = prev.find(layer => layer.id === layerId);\n                if (existingLayer && existingLayer.width !== currentWidth) {\n                    return prev.map(layer => \n                        layer.id === layerId \n                            ? { ...layer, width: currentWidth }\n                            : layer\n                    );\n                }\n                return prev;\n            });\n        }\n    }, []);\n\n    // Use useEffect to measure width after initial render instead of ref callback\n    useEffect(() => {\n        layers.forEach(layer => {\n            if (!layer.width) {\n                const element = document.querySelector(`[data-layer-id=\"${layer.id}\"]`);\n                if (element && element instanceof HTMLDivElement) {\n                    const width = element.offsetWidth;\n                    setLayers(prev => prev.map(l => \n                        l.id === layer.id ? { ...l, width } : l\n                    ));\n                }\n            }\n        });\n    }, [layers.length]); // Only run when number of layers changes\n\n    // Helper function to get handle positions - using actual width\n    const getHandlePosition = (layer: DroppedLayer, type: 'input' | 'output') => {\n        if (type === 'input') {\n            return {\n                x: layer.x - 8,\n                y: layer.y + 50\n            };\n        } else {\n            const nodeWidth = layer.width || 270;\n            return {\n                x: layer.x + nodeWidth + 8,\n                y: layer.y + 50\n            };\n        }\n    };\n\n    // Update connection line positions to connect handles\n    const getLayerCenter = (layer: DroppedLayer) => {\n        return {\n            x: layer.x + 60,\n            y: layer.y + 50\n        };\n    };\n\n    // Updated render connections to use screen coordinates\n    const renderConnections = () => {\n        const connectionLines = connections.map((connection, index) => {\n            const fromLayer = layers.find(l => l.id === connection.from);\n            const toLayer = layers.find(l => l.id === connection.to);\n            \n            if (!fromLayer || !toLayer) return null;\n            \n            const from = getHandlePosition(fromLayer, 'output');\n            const to = getHandlePosition(toLayer, 'input');\n            const fromScreen = canvasToScreen(from.x, from.y);\n            const toScreen = canvasToScreen(to.x, to.y);\n            \n            return (\n                <line\n                    key={`connection-${index}`}\n                    x1={fromScreen.x}\n                    y1={fromScreen.y}\n                    x2={toScreen.x}\n                    y2={toScreen.y}\n                    stroke=\"#007acc\"\n                    strokeWidth={2}\n                    markerEnd=\"url(#arrowhead)\"\n                />\n            );\n        });\n\n        // Add preview connection\n        const previewLine = connectionPreview && (\n            <line\n                key=\"preview\"\n                x1={connectionPreview.from.x}\n                y1={connectionPreview.from.y}\n                x2={connectionPreview.to.x}\n                y2={connectionPreview.to.y}\n                stroke={nearbyHandle ? \"#4caf50\" : \"#ffa726\"}\n                strokeWidth={2}\n                strokeDasharray=\"5,5\"\n                markerEnd=\"url(#previewArrowhead)\"\n            />\n        );\n\n        return (\n            <svg\n                style={{\n                    position: 'absolute',\n                    top: 0,\n                    left: 0,\n                    width: '100%',\n                    height: '100%',\n                    pointerEvents: 'none',\n                    zIndex: 15 // Higher than canvas content but lower than handles\n                }}\n            >\n                <defs>\n                    <marker\n                        id=\"arrowhead\"\n                        markerWidth=\"10\"\n                        markerHeight=\"7\"\n                        refX=\"9\"\n                        refY=\"3.5\"\n                        orient=\"auto\"\n                    >\n                        <polygon\n                            points=\"0 0, 10 3.5, 0 7\"\n                            fill=\"#007acc\"\n                        />\n                    </marker>\n                    <marker\n                        id=\"previewArrowhead\"\n                        markerWidth=\"10\"\n                        markerHeight=\"7\"\n                        refX=\"9\"\n                        refY=\"3.5\"\n                        orient=\"auto\"\n                    >\n                        <polygon\n                            points=\"0 0, 10 3.5, 0 7\"\n                            fill={nearbyHandle ? \"#4caf50\" : \"#ffa726\"}\n                        />\n                    </marker>\n                </defs>\n                {connectionLines}\n                {previewLine}\n            </svg>\n        );\n    };\n\n    return (\n        <div\n            className=\"canvas\"\n            ref={canvasRef}\n            style={{ \n                height: '100%', // Change from minHeight to height for full expansion\n                width: '100%',\n                border: '1px solid #000000ff', \n                position: 'relative', \n                overflow: 'hidden',\n                backgroundColor: '#171717ff',\n                cursor: isPanning ? 'grabbing' : connecting.from !== null ? 'crosshair' : 'default'\n            }}\n            onWheel={handleWheel}\n            onMouseDown={handlePanStart}\n            onMouseMove={handleMouseMove}\n            onMouseUp={handleMouseUp}\n            onClick={handleCanvasClick}\n            onDragOver={(e) => e.preventDefault()}\n            onDrop={(e) => {\n                e.preventDefault();\n                try {\n                    const data = e.dataTransfer.getData('text/plain');\n                    const layer = JSON.parse(data);\n                    \n                    // Calculate drop position relative to canvas\n                    const rect = canvasRef.current?.getBoundingClientRect();\n                    if (rect) {\n                        const x = e.clientX - rect.left;\n                        const y = e.clientY - rect.top;\n                        \n                        handleDrop({\n                            ...layer,\n                            x: x - 60,\n                            y: y - 50\n                        });\n                    }\n                } catch (error) {\n                    console.error('Failed to parse dropped data:', error);\n                }\n            }}\n            tabIndex={0}\n        >\n            {/* Zoom controls */}\n            <div style={{\n                position: 'absolute',\n                top: 10,\n                right: 10,\n                zIndex: 200,\n                display: 'flex',\n                flexDirection: 'column',\n                gap: 5,\n                background: '#0b0b0bff',\n                padding: 8,\n                borderRadius: 7,\n                border: '1px solid #555'\n            }}>\n                <button\n                    onClick={() => setCanvasTransform(prev => ({ ...prev, scale: Math.min(3, prev.scale * 1.2) }))}\n                    style={{\n                        background: '#3a3a3a',\n                        border: '1px solid #555',\n                        color: '#fff',\n                        padding: '4px 8px',\n                        borderRadius: 2,\n                        cursor: 'pointer'\n                    }}\n                >\n                    +\n                </button>\n                <button\n                    onClick={() => setCanvasTransform(prev => ({ ...prev, scale: Math.max(0.1, prev.scale / 1.2) }))}\n                    style={{\n                        background: '#3a3a3a',\n                        border: '1px solid #555',\n                        color: '#fff',\n                        padding: '4px 8px',\n                        borderRadius: 2,\n                        cursor: 'pointer'\n                    }}\n                >\n                    -\n                </button>\n                <button\n                    onClick={resetTransform}\n                    style={{\n                        background: '#3a3a3a',\n                        border: '1px solid #555',\n                        color: '#fff',\n                        padding: '4px 8px',\n                        borderRadius: 2,\n                        cursor: 'pointer',\n                        fontSize: 10\n                    }}\n                >\n                    Reset\n                </button>\n                <div style={{ color: '#ccc', fontSize: 10, textAlign: 'center' }}>\n                    {Math.round(canvasTransform.scale * 100)}%\n                </div>\n            </div>\n\n            {/* Help text */}\n            <div style={{\n                position: 'absolute',\n                bottom: 10,\n                left: 10,\n                color: '#888',\n                fontSize: 11,\n                background: 'rgba(45, 45, 45, 0.8)',\n                padding: '4px 8px',\n                borderRadius: 4,\n                zIndex: 200\n            }}>\n                Scroll to zoom â€¢ Ctrl+Click or Middle-click to pan<br/>\n                Click red dot then green dot to connect nodes\n            </div>\n\n            {/* Canvas content with transform */}\n            <div\n                ref={contentRef}\n                style={{\n                    transform: `translate(${canvasTransform.x}px, ${canvasTransform.y}px) scale(${canvasTransform.scale})`,\n                    transformOrigin: '0 0',\n                    position: 'absolute',\n                    width: '100%',\n                    height: '100%',\n                    zIndex: 10,\n                    pointerEvents: 'auto'\n                }}\n            >\n                {/* Render blocks */}\n                {layers.map((layer) => {\n                    const LayerComponent = layerComponentMap[layer.type];\n                    if (!LayerComponent) return null;\n                    \n                    const isSelected = selectedLayerId === layer.id;\n                    const isConnecting = connecting.from === layer.id;\n                    const isNearbyTarget = nearbyHandle === layer.id;\n                    \n                    // Inline parameter editing UI for demo\n                    const paramInputs = Object.keys(layer.parameters).map(param => {\n                        const value = layer.parameters[param];\n                        const displayValue = Array.isArray(value) ? value.join(', ') : String(value);\n                        \n                        return (\n                            <div key={param} style={{ marginBottom: 4 }}>\n                                <label style={{ fontSize: 12, color: '#ccc' }}>{param}: </label>\n                                <input\n                                    style={{ \n                                        fontSize: 12, \n                                        width: 80,\n                                        backgroundColor: '#3a3a3a',\n                                        border: '1px solid #555',\n                                        color: '#ffffff',\n                                        padding: '2px 4px',\n                                        borderRadius: '2px'\n                                    }}\n                                    value={displayValue}\n                                    onChange={e => handleParamChange(layer.id, param, e.target.value)}\n                                    placeholder={param.includes('Shape') ? \"e.g. 28, 28, 1\" : \"\"}\n                                    onMouseDown={(e) => e.stopPropagation()}\n                                    onFocus={(e) => e.stopPropagation()}\n                                />\n                            </div>\n                        );\n                    });\n                    \n                    return (\n                        <div key={layer.id}>\n                            {/* Input Handle */}\n                            <div\n                                style={{\n                                    position: 'absolute',\n                                    left: layer.x - 8,\n                                    top: layer.y + 42,\n                                    width: 16,\n                                    height: 16,\n                                    backgroundColor: isNearbyTarget ? '#81c784' : '#4caf50',\n                                    borderRadius: '50%',\n                                    border: '2px solid #ffffff',\n                                    cursor: 'pointer',\n                                    zIndex: 100,\n                                    boxShadow: isNearbyTarget ? '0 0 8px rgba(129, 199, 132, 0.8)' : '0 2px 4px rgba(0, 0, 0, 0.3)',\n                                    transform: isNearbyTarget ? 'scale(1.2)' : 'scale(1)',\n                                    transition: 'all 0.2s ease',\n                                    pointerEvents: 'auto'\n                                }}\n                                onMouseDown={(e) => {\n                                    console.log('Input handle mouse down'); // Debug log\n                                    handleConnectionStart(layer.id, 'input', e);\n                                }}\n                                onMouseUp={(e) => {\n                                    console.log('Input handle mouse up'); // Debug log\n                                    handleConnectionEnd(layer.id, 'input', e);\n                                }}\n                                onClick={(e) => {\n                                    console.log('Input handle clicked'); // Debug log\n                                    e.preventDefault();\n                                    e.stopPropagation();\n                                }}\n                                title=\"Input - Click to connect from another node's output\"\n                            />\n                            \n                            {/* Main Node */}\n                            <div\n                                data-layer-id={layer.id}\n                                style={{\n                                    position: 'absolute',\n                                    left: layer.x,\n                                    top: layer.y,\n                                    background: isConnecting ? '#1e3a5f' : isSelected ? '#3a3a3a' : '#2d2d2d',\n                                    border: isConnecting ? '2px solid #007acc' : isSelected ? '2px solid #ff6b6b' : '2px solid #555',\n                                    borderRadius: 8,\n                                    padding: 12,\n                                    minWidth: 120,\n                                    cursor: connecting.from !== null ? 'crosshair' : isPanning ? 'grabbing' : 'move',\n                                    zIndex: draggedId === layer.id ? 80 : 30, // Below handles\n                                    color: '#ffffff',\n                                    boxShadow: isSelected ? '0 0 10px rgba(255, 107, 107, 0.3)' : '0 2px 8px rgba(0, 0, 0, 0.3)',\n                                    userSelect: 'none',\n                                    WebkitUserSelect: 'none',\n                                    MozUserSelect: 'none',\n                                    msUserSelect: 'none',\n                                    pointerEvents: 'auto'\n                                }}\n                                onMouseDown={e => handleMouseDown(layer.id, e)}\n                            >\n                                <LayerComponent {...layer.parameters} />\n                                <div style={{ marginTop: 8, userSelect: 'none' }}>{paramInputs}</div>\n                            </div>\n                            \n                            {/* Output Handle */}\n                            <div\n                                style={{\n                                    position: 'absolute',\n                                    left: layer.x + (layer.width || 270) + 8,\n                                    top: layer.y + 42,\n                                    width: 16,\n                                    height: 16,\n                                    backgroundColor: '#f44336',\n                                    borderRadius: '50%',\n                                    border: '2px solid #ffffff',\n                                    cursor: 'pointer',\n                                    zIndex: 100,\n                                    boxShadow: connecting.from === layer.id ? '0 0 8px rgba(244, 67, 54, 0.8)' : '0 2px 4px rgba(0, 0, 0, 0.3)',\n                                    transform: connecting.from === layer.id ? 'scale(1.2)' : 'scale(1)',\n                                    transition: 'all 0.2s ease',\n                                    pointerEvents: 'auto'\n                                }}\n                                onMouseDown={(e) => {\n                                    console.log('Output handle mouse down'); // Debug log\n                                    handleConnectionStart(layer.id, 'output', e);\n                                }}\n                                onMouseUp={(e) => {\n                                    console.log('Output handle mouse up'); // Debug log\n                                    handleConnectionEnd(layer.id, 'output', e);\n                                }}\n                                onClick={(e) => {\n                                    console.log('Output handle clicked'); // Debug log\n                                    e.preventDefault();\n                                    e.stopPropagation();\n                                }}\n                                title=\"Output - Click and drag to connect to another node's output\"\n                            />\n                        </div>\n                    );\n                })}\n            </div>\n\n            {/* Render connection lines */}\n            {renderConnections()}\n        </div>\n    );\n});\n\nexport default Canvas;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}