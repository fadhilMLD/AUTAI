{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Fadhi\\\\Downloads\\\\Essentials\\\\ai_maker\\\\dragflow-nn-builder\\\\src\\\\components\\\\canvas\\\\Canvas.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\nimport InputLayer from '../layers/InputLayer';\nimport Conv2DLayer from '../layers/Conv2DLayer';\nimport OutputLayer from '../layers/OutputLayer';\nimport ConcatLayer from '../layers/ConcatLayer';\nimport LinearLayer from '../layers/LinearLayer';\nimport FlattenLayer from '../layers/FlattenLayer';\nimport MaxPoolLayer from '../layers/MaxPoolLayer';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst layerComponentMap = {\n  InputLayer: InputLayer,\n  Conv2DLayer: Conv2DLayer,\n  OutputLayer: OutputLayer,\n  ConcatLayer: ConcatLayer,\n  LinearLayer: LinearLayer,\n  FlattenLayer: FlattenLayer,\n  MaxPoolLayer: MaxPoolLayer\n};\nconst defaultParams = {\n  InputLayer: {\n    inputShape: [28, 28, 1]\n  },\n  Conv2DLayer: {\n    filterSize: 3,\n    numFilters: 32,\n    activationFunction: 'relu'\n  },\n  OutputLayer: {\n    outputShape: [10],\n    activationFunction: 'softmax'\n  },\n  ConcatLayer: {\n    layers: []\n  },\n  LinearLayer: {\n    inputSize: 128,\n    outputSize: 64,\n    bias: true,\n    activation: 'relu'\n  },\n  FlattenLayer: {\n    startDim: 1,\n    endDim: -1\n  },\n  MaxPoolLayer: {\n    poolSize: 2,\n    stride: 2,\n    padding: 'valid'\n  }\n};\nconst Canvas = /*#__PURE__*/React.forwardRef(_c = _s((props, ref) => {\n  _s();\n  const [layers, setLayers] = useState([]);\n  const [connections, setConnections] = useState([]);\n  const [draggedId, setDraggedId] = useState(null);\n  const [dragOffset, setDragOffset] = useState({\n    x: 0,\n    y: 0\n  });\n  const [connecting, setConnecting] = useState({\n    from: null,\n    to: null\n  });\n  const [selectedLayerId, setSelectedLayerId] = useState(null);\n  const [connectionPreview, setConnectionPreview] = useState(null);\n  const [nearbyHandle, setNearbyHandle] = useState(null);\n\n  // Canvas transform state\n  const [canvasTransform, setCanvasTransform] = useState({\n    x: 0,\n    y: 0,\n    scale: 1\n  });\n  const [isPanning, setIsPanning] = useState(false);\n  const [panStart, setPanStart] = useState({\n    x: 0,\n    y: 0\n  });\n  const canvasRef = useRef(null);\n  const contentRef = useRef(null);\n\n  // Keyboard event handler for deleting selected nodes\n  useEffect(() => {\n    const handleKeyDown = e => {\n      // Don't delete if user is typing in an input field\n      const activeElement = document.activeElement;\n      if (activeElement instanceof HTMLInputElement || activeElement instanceof HTMLTextAreaElement || activeElement instanceof HTMLSelectElement) {\n        return;\n      }\n      if ((e.key === 'Delete' || e.key === 'Backspace') && selectedLayerId !== null) {\n        // Remove the selected layer\n        setLayers(prev => prev.filter(l => l.id !== selectedLayerId));\n        // Remove all connections involving this layer\n        setConnections(prev => prev.filter(conn => conn.from !== selectedLayerId && conn.to !== selectedLayerId));\n        setSelectedLayerId(null);\n        e.preventDefault();\n      }\n    };\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [selectedLayerId]);\n\n  // Zoom and pan controls - reduced sensitivity\n  const handleWheel = useCallback(e => {\n    // Only call preventDefault if needed and if it's not a passive listener\n    if (e.cancelable) {\n      e.preventDefault();\n    }\n    if (!canvasRef.current) return;\n    const rect = canvasRef.current.getBoundingClientRect();\n    const mouseX = e.clientX - rect.left;\n    const mouseY = e.clientY - rect.top;\n\n    // Reduced sensitivity: changed from -0.01 to -0.001\n    const delta = e.deltaY * -0.001;\n    const scaleFactor = Math.max(0.1, Math.min(3, canvasTransform.scale + delta));\n\n    // Calculate new position to zoom towards mouse position\n    const newX = mouseX - (mouseX - canvasTransform.x) * (scaleFactor / canvasTransform.scale);\n    const newY = mouseY - (mouseY - canvasTransform.y) * (scaleFactor / canvasTransform.scale);\n    setCanvasTransform({\n      x: newX,\n      y: newY,\n      scale: scaleFactor\n    });\n  }, [canvasTransform]);\n  const handlePanStart = useCallback(e => {\n    // Only start panning if middle mouse button or space + left click\n    if (e.button === 1 || e.button === 0 && e.ctrlKey) {\n      e.preventDefault();\n      setIsPanning(true);\n      setPanStart({\n        x: e.clientX - canvasTransform.x,\n        y: e.clientY - canvasTransform.y\n      });\n    }\n  }, [canvasTransform]);\n  const handlePanMove = useCallback(e => {\n    if (isPanning) {\n      e.preventDefault();\n      setCanvasTransform(prev => ({\n        ...prev,\n        x: e.clientX - panStart.x,\n        y: e.clientY - panStart.y\n      }));\n    }\n  }, [isPanning, panStart]);\n  const handlePanEnd = useCallback(() => {\n    setIsPanning(false);\n  }, []);\n\n  // Reset zoom and pan\n  const resetTransform = useCallback(() => {\n    setCanvasTransform({\n      x: 0,\n      y: 0,\n      scale: 1\n    });\n  }, []);\n\n  // Convert screen coordinates to canvas coordinates\n  const screenToCanvas = useCallback((screenX, screenY) => {\n    return {\n      x: (screenX - canvasTransform.x) / canvasTransform.scale,\n      y: (screenY - canvasTransform.y) / canvasTransform.scale\n    };\n  }, [canvasTransform]);\n\n  // Convert canvas coordinates to screen coordinates\n  const canvasToScreen = useCallback((canvasX, canvasY) => {\n    return {\n      x: canvasX * canvasTransform.scale + canvasTransform.x,\n      y: canvasY * canvasTransform.scale + canvasTransform.y\n    };\n  }, [canvasTransform]);\n\n  // Add new layer at the mouse drop position - fixed for transforms\n  const handleDrop = layer => {\n    // Define unavailable layer types\n    const unavailableTypes = ['Conv2DLayer', 'MaxPoolLayer', 'FlattenLayer', 'ConcatLayer'];\n\n    // Prevent dropping unavailable layers\n    if (unavailableTypes.includes(layer.type)) {\n      console.log(`${layer.type} is not available yet`);\n      return;\n    }\n\n    // Only allow valid LayerType\n    if (!['InputLayer', 'Conv2DLayer', 'OutputLayer', 'ConcatLayer', 'LinearLayer', 'FlattenLayer', 'MaxPoolLayer'].includes(layer.type)) {\n      return;\n    }\n    const validLayerTypes = ['InputLayer', 'Conv2DLayer', 'OutputLayer', 'ConcatLayer', 'LinearLayer', 'FlattenLayer', 'MaxPoolLayer'];\n    const type = validLayerTypes.find(t => t === layer.type);\n    if (!type) {\n      return;\n    }\n\n    // Convert drop position to canvas coordinates if provided\n    let dropX = 100;\n    let dropY = 100;\n    if (layer.x !== undefined && layer.y !== undefined) {\n      const canvasCoords = screenToCanvas(layer.x, layer.y);\n      dropX = canvasCoords.x;\n      dropY = canvasCoords.y;\n    }\n    setLayers(prev => [...prev, {\n      ...layer,\n      type: type,\n      parameters: {\n        ...defaultParams[type]\n      },\n      x: dropX,\n      y: dropY\n    }]);\n  };\n\n  // Improved drag logic with input element detection and selection\n  const handleMouseDown = (id, e) => {\n    // Prevent dragging if clicking on input elements, labels, or select elements\n    const target = e.target;\n    if (target instanceof HTMLInputElement || target instanceof HTMLLabelElement || target instanceof HTMLSelectElement) {\n      return;\n    }\n\n    // Don't start dragging if we're connecting or panning\n    if (connecting.from !== null || isPanning) {\n      return;\n    }\n\n    // Set selected layer\n    setSelectedLayerId(id);\n    if (!canvasRef.current) return;\n    const layer = layers.find(l => l.id === id);\n    if (!layer) return;\n    const rect = canvasRef.current.getBoundingClientRect();\n    const screenX = e.clientX - rect.left;\n    const screenY = e.clientY - rect.top;\n    const canvasCoords = screenToCanvas(screenX, screenY);\n\n    // Calculate offset from mouse position to layer's top-left corner\n    const offsetX = canvasCoords.x - layer.x;\n    const offsetY = canvasCoords.y - layer.y;\n    setDraggedId(id);\n    setDragOffset({\n      x: offsetX,\n      y: offsetY\n    });\n    e.stopPropagation();\n  };\n\n  // Click outside to deselect\n  const handleCanvasClick = e => {\n    if (e.target === canvasRef.current) {\n      setSelectedLayerId(null);\n    }\n  };\n  const handleMouseUp = () => {\n    setDraggedId(null);\n    setDragOffset({\n      x: 0,\n      y: 0\n    });\n    handlePanEnd();\n\n    // End connection if we're connecting\n    if (connecting.from !== null) {\n      setConnecting({\n        from: null,\n        to: null\n      });\n      setConnectionPreview(null);\n      setNearbyHandle(null);\n    }\n  };\n  const handleMouseMove = e => {\n    if (!canvasRef.current) return;\n    const rect = canvasRef.current.getBoundingClientRect();\n    const screenX = e.clientX - rect.left;\n    const screenY = e.clientY - rect.top;\n    const canvasCoords = screenToCanvas(screenX, screenY);\n\n    // Handle panning\n    handlePanMove(e);\n\n    // Handle node dragging\n    if (draggedId !== null && !isPanning) {\n      const x = canvasCoords.x - dragOffset.x;\n      const y = canvasCoords.y - dragOffset.y;\n      setLayers(prev => prev.map(l => l.id === draggedId ? {\n        ...l,\n        x,\n        y\n      } : l));\n    }\n\n    // Handle connection preview\n    if (connecting.from !== null) {\n      const fromLayer = layers.find(l => l.id === connecting.from);\n      if (fromLayer) {\n        const fromPos = getHandlePosition(fromLayer, 'output');\n        const fromScreen = canvasToScreen(fromPos.x, fromPos.y);\n\n        // Check for nearby input handles\n        let closestHandle = null;\n        let minDistance = 30; // Snap distance\n\n        layers.forEach(layer => {\n          if (layer.id !== connecting.from) {\n            const inputPos = getHandlePosition(layer, 'input');\n            const inputScreen = canvasToScreen(inputPos.x, inputPos.y);\n            const distance = Math.sqrt(Math.pow(screenX - inputScreen.x, 2) + Math.pow(screenY - inputScreen.y, 2));\n            if (distance < minDistance) {\n              minDistance = distance;\n              closestHandle = layer.id;\n            }\n          }\n        });\n        setNearbyHandle(closestHandle);\n\n        // Set preview line (in screen coordinates for SVG)\n        if (closestHandle) {\n          const targetLayer = layers.find(l => l.id === closestHandle);\n          if (targetLayer) {\n            const targetPos = getHandlePosition(targetLayer, 'input');\n            const targetScreen = canvasToScreen(targetPos.x, targetPos.y);\n            setConnectionPreview({\n              from: fromScreen,\n              to: targetScreen\n            });\n          }\n        } else {\n          setConnectionPreview({\n            from: fromScreen,\n            to: {\n              x: screenX,\n              y: screenY\n            }\n          });\n        }\n      }\n    }\n  };\n\n  // Inline parameter editing with proper type conversion\n  const handleParamChange = (id, param, value) => {\n    setLayers(prev => prev.map(l => {\n      if (l.id === id) {\n        let convertedValue = value;\n\n        // Convert numeric strings to numbers\n        if (!isNaN(Number(value)) && value.trim() !== '') {\n          convertedValue = Number(value);\n        }\n\n        // Handle array inputs (for inputShape, outputShape)\n        if (param.includes('Shape') && typeof value === 'string') {\n          try {\n            // Parse comma-separated values as array\n            convertedValue = value.split(',').map(v => Number(v.trim())).filter(v => !isNaN(v));\n          } catch {\n            convertedValue = value;\n          }\n        }\n        return {\n          ...l,\n          parameters: {\n            ...l.parameters,\n            [param]: convertedValue\n          }\n        };\n      }\n      return l;\n    }));\n  };\n\n  // Handler for ID changes\n  const handleIdChange = (currentId, newIdValue) => {\n    // Parse the new ID as a number\n    const newId = parseInt(newIdValue);\n\n    // Validate that the new ID is a valid number and not already used\n    if (isNaN(newId) || newId <= 0) {\n      return; // Invalid ID, don't update\n    }\n\n    // Check if the new ID is already in use by another layer\n    const existingLayer = layers.find(l => l.id === newId && l.id !== currentId);\n    if (existingLayer) {\n      // ID already exists, could show a warning or auto-generate a unique ID\n      return;\n    }\n\n    // Update the layer ID\n    setLayers(prev => prev.map(l => l.id === currentId ? {\n      ...l,\n      id: newId\n    } : l));\n\n    // Update connections to use the new ID\n    setConnections(prev => prev.map(conn => ({\n      from: conn.from === currentId ? newId : conn.from,\n      to: conn.to === currentId ? newId : conn.to\n    })));\n\n    // Update selected layer ID if this layer was selected\n    if (selectedLayerId === currentId) {\n      setSelectedLayerId(newId);\n    }\n  };\n\n  // Connection logic with handles\n  const handleConnectionStart = (id, type, e) => {\n    console.log('Connection start:', {\n      id,\n      type\n    }); // Debug log\n    e.preventDefault();\n    e.stopPropagation();\n    if (type === 'output') {\n      setConnecting({\n        from: id,\n        to: null\n      });\n      console.log('Started connecting from node:', id); // Debug log\n    }\n  };\n  const handleConnectionEnd = (id, type, e) => {\n    console.log('Connection end:', {\n      id,\n      type,\n      connectingFrom: connecting.from\n    }); // Debug log\n    e.preventDefault();\n    e.stopPropagation();\n    if (type === 'input' && connecting.from !== null && connecting.from !== id) {\n      // Check if connection already exists\n      const existingConnectionIndex = connections.findIndex(conn => conn.from === connecting.from && conn.to === id);\n      if (existingConnectionIndex !== -1) {\n        // Disconnect if connection exists\n        console.log('Removing existing connection'); // Debug log\n        setConnections(prev => prev.filter((_, index) => index !== existingConnectionIndex));\n      } else {\n        // Connect if no connection exists\n        console.log('Creating new connection from', connecting.from, 'to', id); // Debug log\n        const fromId = connecting.from;\n        setConnections(prev => [...prev, {\n          from: fromId,\n          to: id\n        }]);\n      }\n    }\n\n    // Always clear connection state\n    setConnecting({\n      from: null,\n      to: null\n    });\n    setConnectionPreview(null);\n    setNearbyHandle(null);\n  };\n\n  // Function to get all model data for export\n  const getModelData = () => {\n    return {\n      layers: layers.map(layer => ({\n        id: layer.id,\n        type: layer.type,\n        parameters: layer.parameters,\n        position: {\n          x: layer.x,\n          y: layer.y\n        }\n      })),\n      connections: connections.map(connection => ({\n        from: connection.from,\n        to: connection.to\n      }))\n    };\n  };\n\n  // Expose the getModelData function via ref\n  React.useImperativeHandle(ref, () => ({\n    getModelData\n  }));\n\n  // Function to update node width after render - optimized to prevent infinite loops\n  const updateNodeWidth = useCallback((layerId, element) => {\n    if (element) {\n      const currentWidth = element.offsetWidth;\n\n      // Only update if width has actually changed\n      setLayers(prev => {\n        const existingLayer = prev.find(layer => layer.id === layerId);\n        if (existingLayer && existingLayer.width !== currentWidth) {\n          return prev.map(layer => layer.id === layerId ? {\n            ...layer,\n            width: currentWidth\n          } : layer);\n        }\n        return prev;\n      });\n    }\n  }, []);\n\n  // Use useEffect to measure width after initial render instead of ref callback\n  useEffect(() => {\n    layers.forEach(layer => {\n      if (!layer.width) {\n        const element = document.querySelector(`[data-layer-id=\"${layer.id}\"]`);\n        if (element && element instanceof HTMLDivElement) {\n          const width = element.offsetWidth;\n          setLayers(prev => prev.map(l => l.id === layer.id ? {\n            ...l,\n            width\n          } : l));\n        }\n      }\n    });\n  }, [layers.length]); // Only run when number of layers changes\n\n  // Helper function to get handle positions - using actual width\n  const getHandlePosition = (layer, type) => {\n    if (type === 'input') {\n      return {\n        x: layer.x - 8,\n        y: layer.y + 50\n      };\n    } else {\n      const nodeWidth = layer.width || 270;\n      return {\n        x: layer.x + nodeWidth + 8,\n        y: layer.y + 50\n      };\n    }\n  };\n\n  // Update connection line positions to connect handles\n  const getLayerCenter = layer => {\n    return {\n      x: layer.x + 60,\n      y: layer.y + 50\n    };\n  };\n\n  // Updated render connections to use screen coordinates\n  const renderConnections = () => {\n    const connectionLines = connections.map((connection, index) => {\n      const fromLayer = layers.find(l => l.id === connection.from);\n      const toLayer = layers.find(l => l.id === connection.to);\n      if (!fromLayer || !toLayer) return null;\n      const from = getHandlePosition(fromLayer, 'output');\n      const to = getHandlePosition(toLayer, 'input');\n      const fromScreen = canvasToScreen(from.x, from.y);\n      const toScreen = canvasToScreen(to.x, to.y);\n      return /*#__PURE__*/_jsxDEV(\"line\", {\n        x1: fromScreen.x,\n        y1: fromScreen.y,\n        x2: toScreen.x,\n        y2: toScreen.y,\n        stroke: \"#007acc\",\n        strokeWidth: 2,\n        markerEnd: \"url(#arrowhead)\"\n      }, `connection-${index}`, false, {\n        fileName: _jsxFileName,\n        lineNumber: 538,\n        columnNumber: 17\n      }, this);\n    });\n\n    // Add preview connection\n    const previewLine = connectionPreview && /*#__PURE__*/_jsxDEV(\"line\", {\n      x1: connectionPreview.from.x,\n      y1: connectionPreview.from.y,\n      x2: connectionPreview.to.x,\n      y2: connectionPreview.to.y,\n      stroke: nearbyHandle ? \"#4caf50\" : \"#ffa726\",\n      strokeWidth: 2,\n      strokeDasharray: \"5,5\",\n      markerEnd: \"url(#previewArrowhead)\"\n    }, \"preview\", false, {\n      fileName: _jsxFileName,\n      lineNumber: 553,\n      columnNumber: 13\n    }, this);\n    return /*#__PURE__*/_jsxDEV(\"svg\", {\n      style: {\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        width: '100%',\n        height: '100%',\n        pointerEvents: 'none',\n        zIndex: 15 // Higher than canvas content but lower than handles\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"defs\", {\n        children: [/*#__PURE__*/_jsxDEV(\"marker\", {\n          id: \"arrowhead\",\n          markerWidth: \"10\",\n          markerHeight: \"7\",\n          refX: \"9\",\n          refY: \"3.5\",\n          orient: \"auto\",\n          children: /*#__PURE__*/_jsxDEV(\"polygon\", {\n            points: \"0 0, 10 3.5, 0 7\",\n            fill: \"#007acc\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 587,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 579,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"marker\", {\n          id: \"previewArrowhead\",\n          markerWidth: \"10\",\n          markerHeight: \"7\",\n          refX: \"9\",\n          refY: \"3.5\",\n          orient: \"auto\",\n          children: /*#__PURE__*/_jsxDEV(\"polygon\", {\n            points: \"0 0, 10 3.5, 0 7\",\n            fill: nearbyHandle ? \"#4caf50\" : \"#ffa726\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 600,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 592,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 578,\n        columnNumber: 17\n      }, this), connectionLines, previewLine]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 567,\n      columnNumber: 13\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"canvas\",\n    ref: canvasRef,\n    style: {\n      height: '100%',\n      width: '100%',\n      border: '1px solid rgba(255, 255, 255, 0.03)',\n      position: 'relative',\n      overflow: 'hidden',\n      background: `\n                    linear-gradient(135deg, #0a0a10 0%, #12121a 100%)\n                    repeating-linear-gradient(rgba(255, 255, 255, 0.02) 0px, rgba(255, 255, 255, 0.02) 1px, transparent 1px, transparent 20px),\n                    repeating-linear-gradient(90deg, rgba(255, 255, 255, 0.02) 0px, rgba(255, 255, 255, 0.02) 1px, transparent 1px, transparent 20px)\n                `,\n      backgroundSize: `\n                    100% 100%,\n                    20px 20px,\n                    20px 20px\n                `,\n      cursor: isPanning ? 'grabbing' : connecting.from !== null ? 'crosshair' : 'default',\n      boxShadow: 'inset 0 0 50px rgba(0, 0, 0, 0.4)'\n    },\n    onWheel: handleWheel,\n    onMouseDown: handlePanStart,\n    onMouseMove: handleMouseMove,\n    onMouseUp: handleMouseUp,\n    onClick: handleCanvasClick,\n    onDragOver: e => e.preventDefault(),\n    onDrop: e => {\n      e.preventDefault();\n      try {\n        var _canvasRef$current;\n        const data = e.dataTransfer.getData('text/plain');\n        const layer = JSON.parse(data);\n\n        // Calculate drop position relative to canvas\n        const rect = (_canvasRef$current = canvasRef.current) === null || _canvasRef$current === void 0 ? void 0 : _canvasRef$current.getBoundingClientRect();\n        if (rect) {\n          const x = e.clientX - rect.left;\n          const y = e.clientY - rect.top;\n          handleDrop({\n            ...layer,\n            x: x - 60,\n            y: y - 50\n          });\n        }\n      } catch (error) {\n        console.error('Failed to parse dropped data:', error);\n      }\n    },\n    tabIndex: 0,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        top: 10,\n        right: 10,\n        zIndex: 200,\n        display: 'flex',\n        flexDirection: 'column',\n        gap: 5,\n        background: 'linear-gradient(135deg, #12121a 0%, #1a1a24 100%)',\n        padding: 8,\n        borderRadius: 10,\n        border: '1px solid rgba(255, 255, 255, 0.05)',\n        boxShadow: '0 2px 15px rgba(0, 0, 0, 0.4)'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setCanvasTransform(prev => ({\n          ...prev,\n          scale: Math.min(3, prev.scale * 1.2)\n        })),\n        style: {\n          background: 'linear-gradient(135deg, #2a4d7a 0%, #3d5a7a 100%)',\n          border: 'none',\n          color: '#fff',\n          padding: '6px 10px',\n          borderRadius: 6,\n          cursor: 'pointer',\n          fontWeight: 'bold'\n        },\n        children: \"+\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 680,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setCanvasTransform(prev => ({\n          ...prev,\n          scale: Math.max(0.1, prev.scale / 1.2)\n        })),\n        style: {\n          background: 'linear-gradient(135deg, #2a4d7a 0%, #3d5a7a 100%)',\n          border: 'none',\n          color: '#fff',\n          padding: '6px 10px',\n          borderRadius: 6,\n          cursor: 'pointer',\n          fontWeight: 'bold'\n        },\n        children: \"-\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 694,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: resetTransform,\n        style: {\n          background: 'rgba(255, 255, 255, 0.05)',\n          border: 'none',\n          color: '#fff',\n          padding: '6px 10px',\n          borderRadius: 6,\n          cursor: 'pointer',\n          fontSize: 10\n        },\n        children: \"Reset\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 708,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          color: '#fff',\n          fontSize: 10,\n          textAlign: 'center',\n          padding: '4px 0',\n          background: 'rgba(255, 255, 255, 0.05)',\n          borderRadius: 6\n        },\n        children: [Math.round(canvasTransform.scale * 100), \"%\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 722,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 666,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        bottom: 10,\n        left: 10,\n        color: '#b0b8c4',\n        fontSize: 11,\n        background: 'linear-gradient(135deg, rgba(18, 18, 26, 0.8) 0%, rgba(30, 30, 45, 0.8) 100%)',\n        padding: '8px 12px',\n        borderRadius: 8,\n        zIndex: 200,\n        backdropFilter: 'blur(5px)',\n        boxShadow: '0 2px 10px rgba(0, 0, 0, 0.4)',\n        border: '1px solid rgba(255, 255, 255, 0.05)'\n      },\n      children: [\"Scroll to zoom \\u2022 Ctrl+Click or Middle-click to pan\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 749,\n        columnNumber: 67\n      }, this), \"Click red dot then green dot to connect nodes\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 735,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: contentRef,\n      style: {\n        transform: `translate(${canvasTransform.x}px, ${canvasTransform.y}px) scale(${canvasTransform.scale})`,\n        transformOrigin: '0 0',\n        position: 'absolute',\n        width: '100%',\n        height: '100%',\n        zIndex: 10,\n        pointerEvents: 'auto',\n        backgroundImage: `\n                        linear-gradient(rgba(255, 255, 255, 0.01) 1px, transparent 1px),\n                        linear-gradient(90deg, rgba(255, 255, 255, 0.01) 1px, transparent 1px)\n                    `,\n        backgroundSize: '20px 20px',\n        backgroundPosition: '0 0'\n      },\n      children: layers.map(layer => {\n        const LayerComponent = layerComponentMap[layer.type];\n        if (!LayerComponent) return null;\n        const isSelected = selectedLayerId === layer.id;\n        const isConnecting = connecting.from === layer.id;\n        const isNearbyTarget = nearbyHandle === layer.id;\n\n        // Get gradient based on layer type\n        const getLayerGradient = type => {\n          const gradients = {\n            InputLayer: 'linear-gradient(135deg, #2a8db8 0%, #4a6fa5 100%)',\n            Conv2DLayer: 'linear-gradient(135deg, #7a3d00 0%, #7a2a4d 100%)',\n            OutputLayer: 'linear-gradient(135deg, #005a7a 0%, #00477a 100%)',\n            ConcatLayer: 'linear-gradient(135deg, #4d2a5a 0%, #5a2a5a 100%)',\n            LinearLayer: 'linear-gradient(135deg, #2a4d7a 0%, #4a5a7a 100%)',\n            FlattenLayer: 'linear-gradient(135deg, #7a2a0f 0%, #7a2a2a 100%)',\n            MaxPoolLayer: 'linear-gradient(135deg, #0f5e5e 0%, #1a7a7a 100%)'\n          };\n          return gradients[type] || 'linear-gradient(135deg, #333 0%, #555 100%)';\n        };\n\n        // Inline parameter editing UI for demo\n        const paramInputs = Object.keys(layer.parameters).filter(param => !['activation', 'activationFunction'].includes(param)).map(param => {\n          const value = layer.parameters[param];\n          const displayValue = Array.isArray(value) ? value.join(', ') : String(value);\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              marginBottom: 8\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              style: {\n                fontSize: 12,\n                color: '#b0b8c4',\n                fontWeight: 500\n              },\n              children: [param, \": \"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 804,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              style: {\n                fontSize: 12,\n                width: 90,\n                backgroundColor: 'rgba(255, 255, 255, 0.05)',\n                border: '1px solid rgba(255, 255, 255, 0.1)',\n                color: '#ffffff',\n                padding: '4px 8px',\n                borderRadius: '6px',\n                outline: 'none'\n              },\n              value: displayValue,\n              onChange: e => handleParamChange(layer.id, param, e.target.value),\n              placeholder: param.includes('Shape') ? \"e.g. 28, 28, 1\" : \"\",\n              onMouseDown: e => e.stopPropagation(),\n              onFocus: e => e.stopPropagation()\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 805,\n              columnNumber: 33\n            }, this)]\n          }, param, true, {\n            fileName: _jsxFileName,\n            lineNumber: 803,\n            columnNumber: 29\n          }, this);\n        });\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              position: 'absolute',\n              left: layer.x - 8,\n              top: layer.y + 42,\n              width: 16,\n              height: 16,\n              background: isNearbyTarget ? 'linear-gradient(135deg, #1a4d4d 0%, #2a5a2a 100%)' : 'linear-gradient(135deg, #0f5e5e 0%, #1a7a7a 100%)',\n              borderRadius: '50%',\n              border: '2px solid #ffffff',\n              cursor: 'pointer',\n              zIndex: 100,\n              boxShadow: isNearbyTarget ? '0 0 12px rgba(26, 77, 77, 0.8)' : '0 2px 8px rgba(0, 0, 0, 0.5)',\n              transform: isNearbyTarget ? 'scale(1.2)' : 'scale(1)',\n              transition: 'all 0.2s ease',\n              pointerEvents: 'auto'\n            },\n            onMouseDown: e => {\n              console.log('Input handle mouse down'); // Debug log\n              handleConnectionStart(layer.id, 'input', e);\n            },\n            onMouseUp: e => {\n              console.log('Input handle mouse up'); // Debug log\n              handleConnectionEnd(layer.id, 'input', e);\n            },\n            onClick: e => {\n              console.log('Input handle clicked'); // Debug log\n              e.preventDefault();\n              e.stopPropagation();\n            },\n            title: \"Input - Click to connect from another node's output\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 829,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            \"data-layer-id\": layer.id,\n            style: {\n              position: 'absolute',\n              left: layer.x,\n              top: layer.y,\n              background: isConnecting ? 'linear-gradient(135deg, #0a0a0f 0%, #1a1a24 100%)' : isSelected ? 'linear-gradient(135deg, #1a1a2e 0%, #242438 100%)' : 'linear-gradient(135deg, #161620 0%, #1a1a24 100%)',\n              border: isConnecting ? `2px solid ${getLayerGradient(layer.type)}` : isSelected ? '2px solid #5a5a6b' : '1px solid rgba(255, 255, 255, 0.05)',\n              borderRadius: 12,\n              padding: 16,\n              minWidth: 120,\n              cursor: connecting.from !== null ? 'crosshair' : isPanning ? 'grabbing' : 'move',\n              zIndex: draggedId === layer.id ? 80 : 30,\n              color: '#ffffff',\n              boxShadow: isSelected ? '0 0 20px rgba(90, 90, 107, 0.3)' : '0 4px 20px rgba(0, 0, 0, 0.4)',\n              userSelect: 'none',\n              WebkitUserSelect: 'none',\n              MozUserSelect: 'none',\n              msUserSelect: 'none',\n              pointerEvents: 'auto',\n              backdropFilter: 'blur(5px)'\n            },\n            onMouseDown: e => handleMouseDown(layer.id, e),\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                height: '4px',\n                background: getLayerGradient(layer.type),\n                borderRadius: '10px',\n                marginBottom: '10px',\n                opacity: 0.8\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 902,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(LayerComponent, {\n              ...layer.parameters\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 910,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginTop: 12,\n                userSelect: 'none'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  marginBottom: 8\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                  style: {\n                    fontSize: 12,\n                    color: '#ffa726',\n                    fontWeight: 600,\n                    textShadow: '0 1px 2px rgba(0, 0, 0, 0.3)'\n                  },\n                  children: \"ID:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 916,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"number\",\n                  style: {\n                    fontSize: 12,\n                    width: 90,\n                    backgroundColor: 'rgba(255, 167, 38, 0.1)',\n                    border: '1px solid rgba(255, 167, 38, 0.3)',\n                    color: '#ffa726',\n                    padding: '4px 8px',\n                    borderRadius: '6px',\n                    outline: 'none',\n                    fontWeight: 600\n                  },\n                  value: layer.id,\n                  onChange: e => handleIdChange(layer.id, e.target.value),\n                  onMouseDown: e => e.stopPropagation(),\n                  onFocus: e => e.stopPropagation(),\n                  min: \"1\",\n                  title: \"Layer unique identifier\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 924,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 915,\n                columnNumber: 37\n              }, this), paramInputs]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 913,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 867,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              position: 'absolute',\n              left: layer.x + (layer.width || 270) + 8,\n              top: layer.y + 42,\n              width: 16,\n              height: 16,\n              background: 'linear-gradient(135deg, #7a2a2a 0%, #5a1a1a 100%)',\n              borderRadius: '50%',\n              border: '2px solid #ffffff',\n              cursor: 'pointer',\n              zIndex: 100,\n              boxShadow: connecting.from === layer.id ? '0 0 12px rgba(122, 42, 42, 0.8)' : '0 2px 8px rgba(0, 0, 0, 0.5)',\n              transform: connecting.from === layer.id ? 'scale(1.2)' : 'scale(1)',\n              transition: 'all 0.2s ease',\n              pointerEvents: 'auto'\n            },\n            onMouseDown: e => {\n              console.log('Output handle mouse down'); // Debug log\n              handleConnectionStart(layer.id, 'output', e);\n            },\n            onMouseUp: e => {\n              console.log('Output handle mouse up'); // Debug log\n              handleConnectionEnd(layer.id, 'output', e);\n            },\n            onClick: e => {\n              console.log('Output handle clicked'); // Debug log\n              e.preventDefault();\n              e.stopPropagation();\n            },\n            title: \"Output - Click and drag to connect to another node's output\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 952,\n            columnNumber: 29\n          }, this)]\n        }, layer.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 827,\n          columnNumber: 25\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 754,\n      columnNumber: 13\n    }, this), renderConnections()]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 613,\n    columnNumber: 9\n  }, this);\n}, \"rCUA9omHQGWKVR16Bl2+7NXpZA0=\", false, function () {\n  return [React.useImperativeHandle];\n}));\n_c2 = Canvas;\nexport default Canvas;\nvar _c, _c2;\n$RefreshReg$(_c, \"Canvas$React.forwardRef\");\n$RefreshReg$(_c2, \"Canvas\");","map":{"version":3,"names":["React","useState","useRef","useEffect","useCallback","InputLayer","Conv2DLayer","OutputLayer","ConcatLayer","LinearLayer","FlattenLayer","MaxPoolLayer","jsxDEV","_jsxDEV","layerComponentMap","defaultParams","inputShape","filterSize","numFilters","activationFunction","outputShape","layers","inputSize","outputSize","bias","activation","startDim","endDim","poolSize","stride","padding","Canvas","forwardRef","_c","_s","props","ref","setLayers","connections","setConnections","draggedId","setDraggedId","dragOffset","setDragOffset","x","y","connecting","setConnecting","from","to","selectedLayerId","setSelectedLayerId","connectionPreview","setConnectionPreview","nearbyHandle","setNearbyHandle","canvasTransform","setCanvasTransform","scale","isPanning","setIsPanning","panStart","setPanStart","canvasRef","contentRef","handleKeyDown","e","activeElement","document","HTMLInputElement","HTMLTextAreaElement","HTMLSelectElement","key","prev","filter","l","id","conn","preventDefault","addEventListener","removeEventListener","handleWheel","cancelable","current","rect","getBoundingClientRect","mouseX","clientX","left","mouseY","clientY","top","delta","deltaY","scaleFactor","Math","max","min","newX","newY","handlePanStart","button","ctrlKey","handlePanMove","handlePanEnd","resetTransform","screenToCanvas","screenX","screenY","canvasToScreen","canvasX","canvasY","handleDrop","layer","unavailableTypes","includes","type","console","log","validLayerTypes","find","t","dropX","dropY","undefined","canvasCoords","parameters","handleMouseDown","target","HTMLLabelElement","offsetX","offsetY","stopPropagation","handleCanvasClick","handleMouseUp","handleMouseMove","map","fromLayer","fromPos","getHandlePosition","fromScreen","closestHandle","minDistance","forEach","inputPos","inputScreen","distance","sqrt","pow","targetLayer","targetPos","targetScreen","handleParamChange","param","value","convertedValue","isNaN","Number","trim","split","v","handleIdChange","currentId","newIdValue","newId","parseInt","existingLayer","handleConnectionStart","handleConnectionEnd","connectingFrom","existingConnectionIndex","findIndex","_","index","fromId","getModelData","position","connection","useImperativeHandle","updateNodeWidth","layerId","element","currentWidth","offsetWidth","width","querySelector","HTMLDivElement","length","nodeWidth","getLayerCenter","renderConnections","connectionLines","toLayer","toScreen","x1","y1","x2","y2","stroke","strokeWidth","markerEnd","fileName","_jsxFileName","lineNumber","columnNumber","previewLine","strokeDasharray","style","height","pointerEvents","zIndex","children","markerWidth","markerHeight","refX","refY","orient","points","fill","className","border","overflow","background","backgroundSize","cursor","boxShadow","onWheel","onMouseDown","onMouseMove","onMouseUp","onClick","onDragOver","onDrop","_canvasRef$current","data","dataTransfer","getData","JSON","parse","error","tabIndex","right","display","flexDirection","gap","borderRadius","color","fontWeight","fontSize","textAlign","round","bottom","backdropFilter","transform","transformOrigin","backgroundImage","backgroundPosition","LayerComponent","isSelected","isConnecting","isNearbyTarget","getLayerGradient","gradients","paramInputs","Object","keys","displayValue","Array","isArray","join","String","marginBottom","backgroundColor","outline","onChange","placeholder","onFocus","transition","title","minWidth","userSelect","WebkitUserSelect","MozUserSelect","msUserSelect","opacity","marginTop","textShadow","_c2","$RefreshReg$"],"sources":["C:/Users/Fadhi/Downloads/Essentials/ai_maker/dragflow-nn-builder/src/components/canvas/Canvas.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from 'react';\nimport InputLayer from '../layers/InputLayer';\nimport Conv2DLayer from '../layers/Conv2DLayer';\nimport OutputLayer from '../layers/OutputLayer';\nimport ConcatLayer from '../layers/ConcatLayer';\nimport LinearLayer from '../layers/LinearLayer';\nimport FlattenLayer from '../layers/FlattenLayer';\nimport MaxPoolLayer from '../layers/MaxPoolLayer';\n\ntype LayerType = 'InputLayer' | 'Conv2DLayer' | 'OutputLayer' | 'ConcatLayer' | 'LinearLayer' | 'FlattenLayer' | 'MaxPoolLayer';\n\ninterface LayerProps {\n    [key: string]: any;\n}\n\nconst layerComponentMap: Record<LayerType, React.ComponentType<LayerProps>> = {\n    InputLayer: InputLayer,\n    Conv2DLayer: Conv2DLayer,\n    OutputLayer: OutputLayer,\n    ConcatLayer: ConcatLayer,\n    LinearLayer: LinearLayer,\n    FlattenLayer: FlattenLayer,\n    MaxPoolLayer: MaxPoolLayer,\n};\n\nconst defaultParams: Record<LayerType, Record<string, any>> = {\n    InputLayer: { inputShape: [28, 28, 1] },\n    Conv2DLayer: { filterSize: 3, numFilters: 32, activationFunction: 'relu' },\n    OutputLayer: { outputShape: [10], activationFunction: 'softmax' },\n    ConcatLayer: { layers: [] },\n    LinearLayer: { inputSize: 128, outputSize: 64, bias: true, activation: 'relu' },\n    FlattenLayer: { startDim: 1, endDim: -1 },\n    MaxPoolLayer: { poolSize: 2, stride: 2, padding: 'valid' },\n};\n\ninterface DroppedLayer {\n    type: LayerType;\n    id: number;\n    parameters: Record<string, any>;\n    x: number;\n    y: number;\n    selected?: boolean;\n    width?: number; // Add width property\n}\n\ninterface Connection {\n    from: number;\n    to: number;\n}\n\nconst Canvas = React.forwardRef<{getModelData: () => any}, React.PropsWithChildren<{}>>((props, ref) => {\n    const [layers, setLayers] = useState<DroppedLayer[]>([]);\n    const [connections, setConnections] = useState<Connection[]>([]);\n    const [draggedId, setDraggedId] = useState<number | null>(null);\n    const [dragOffset, setDragOffset] = useState<{ x: number; y: number }>({ x: 0, y: 0 });\n    const [connecting, setConnecting] = useState<{ from: number | null, to: number | null }>({ from: null, to: null });\n    const [selectedLayerId, setSelectedLayerId] = useState<number | null>(null);\n    const [connectionPreview, setConnectionPreview] = useState<{ from: { x: number; y: number }, to: { x: number; y: number } } | null>(null);\n    const [nearbyHandle, setNearbyHandle] = useState<number | null>(null);\n    \n    // Canvas transform state\n    const [canvasTransform, setCanvasTransform] = useState({ \n        x: 0, \n        y: 0, \n        scale: 1 \n    });\n    const [isPanning, setIsPanning] = useState(false);\n    const [panStart, setPanStart] = useState({ x: 0, y: 0 });\n    \n    const canvasRef = useRef<HTMLDivElement>(null);\n    const contentRef = useRef<HTMLDivElement>(null);\n\n    // Keyboard event handler for deleting selected nodes\n    useEffect(() => {\n        const handleKeyDown = (e: KeyboardEvent) => {\n            // Don't delete if user is typing in an input field\n            const activeElement = document.activeElement;\n            if (activeElement instanceof HTMLInputElement || \n                activeElement instanceof HTMLTextAreaElement || \n                activeElement instanceof HTMLSelectElement) {\n                return;\n            }\n\n            if ((e.key === 'Delete' || e.key === 'Backspace') && selectedLayerId !== null) {\n                // Remove the selected layer\n                setLayers(prev => prev.filter(l => l.id !== selectedLayerId));\n                // Remove all connections involving this layer\n                setConnections(prev => prev.filter(\n                    conn => conn.from !== selectedLayerId && conn.to !== selectedLayerId\n                ));\n                setSelectedLayerId(null);\n                e.preventDefault();\n            }\n        };\n\n        document.addEventListener('keydown', handleKeyDown);\n        return () => document.removeEventListener('keydown', handleKeyDown);\n    }, [selectedLayerId]);\n\n    // Zoom and pan controls - reduced sensitivity\n    const handleWheel = useCallback((e: React.WheelEvent) => {\n        // Only call preventDefault if needed and if it's not a passive listener\n        if (e.cancelable) {\n            e.preventDefault();\n        }\n        \n        if (!canvasRef.current) return;\n        \n        const rect = canvasRef.current.getBoundingClientRect();\n        const mouseX = e.clientX - rect.left;\n        const mouseY = e.clientY - rect.top;\n        \n        // Reduced sensitivity: changed from -0.01 to -0.001\n        const delta = e.deltaY * -0.001;\n        const scaleFactor = Math.max(0.1, Math.min(3, canvasTransform.scale + delta));\n        \n        // Calculate new position to zoom towards mouse position\n        const newX = mouseX - (mouseX - canvasTransform.x) * (scaleFactor / canvasTransform.scale);\n        const newY = mouseY - (mouseY - canvasTransform.y) * (scaleFactor / canvasTransform.scale);\n        \n        setCanvasTransform({\n            x: newX,\n            y: newY,\n            scale: scaleFactor\n        });\n    }, [canvasTransform]);\n\n    const handlePanStart = useCallback((e: React.MouseEvent) => {\n        // Only start panning if middle mouse button or space + left click\n        if (e.button === 1 || (e.button === 0 && e.ctrlKey)) {\n            e.preventDefault();\n            setIsPanning(true);\n            setPanStart({ x: e.clientX - canvasTransform.x, y: e.clientY - canvasTransform.y });\n        }\n    }, [canvasTransform]);\n\n    const handlePanMove = useCallback((e: React.MouseEvent) => {\n        if (isPanning) {\n            e.preventDefault();\n            setCanvasTransform(prev => ({\n                ...prev,\n                x: e.clientX - panStart.x,\n                y: e.clientY - panStart.y\n            }));\n        }\n    }, [isPanning, panStart]);\n\n    const handlePanEnd = useCallback(() => {\n        setIsPanning(false);\n    }, []);\n\n    // Reset zoom and pan\n    const resetTransform = useCallback(() => {\n        setCanvasTransform({ x: 0, y: 0, scale: 1 });\n    }, []);\n\n    // Convert screen coordinates to canvas coordinates\n    const screenToCanvas = useCallback((screenX: number, screenY: number) => {\n        return {\n            x: (screenX - canvasTransform.x) / canvasTransform.scale,\n            y: (screenY - canvasTransform.y) / canvasTransform.scale\n        };\n    }, [canvasTransform]);\n\n    // Convert canvas coordinates to screen coordinates\n    const canvasToScreen = useCallback((canvasX: number, canvasY: number) => {\n        return {\n            x: canvasX * canvasTransform.scale + canvasTransform.x,\n            y: canvasY * canvasTransform.scale + canvasTransform.y\n        };\n    }, [canvasTransform]);\n\n    // Add new layer at the mouse drop position - fixed for transforms\n    const handleDrop = (layer: { type: string; id: number; x?: number; y?: number }) => {\n        // Define unavailable layer types\n        const unavailableTypes = ['Conv2DLayer', 'MaxPoolLayer', 'FlattenLayer', 'ConcatLayer'];\n        \n        // Prevent dropping unavailable layers\n        if (unavailableTypes.includes(layer.type)) {\n            console.log(`${layer.type} is not available yet`);\n            return;\n        }\n        \n        // Only allow valid LayerType\n        if (!['InputLayer', 'Conv2DLayer', 'OutputLayer', 'ConcatLayer', 'LinearLayer', 'FlattenLayer', 'MaxPoolLayer'].includes(layer.type)) {\n            return;\n        }\n        \n        const validLayerTypes: LayerType[] = ['InputLayer', 'Conv2DLayer', 'OutputLayer', 'ConcatLayer', 'LinearLayer', 'FlattenLayer', 'MaxPoolLayer'];\n        const type = validLayerTypes.find(t => t === layer.type);\n        \n        if (!type) {\n            return;\n        }\n\n        // Convert drop position to canvas coordinates if provided\n        let dropX = 100;\n        let dropY = 100;\n        \n        if (layer.x !== undefined && layer.y !== undefined) {\n            const canvasCoords = screenToCanvas(layer.x, layer.y);\n            dropX = canvasCoords.x;\n            dropY = canvasCoords.y;\n        }\n        \n        setLayers(prev => [\n            ...prev,\n            {\n                ...layer,\n                type: type,\n                parameters: { ...defaultParams[type] },\n                x: dropX,\n                y: dropY,\n            },\n        ]);\n    };\n\n    // Improved drag logic with input element detection and selection\n    const handleMouseDown = (id: number, e: React.MouseEvent) => {\n        // Prevent dragging if clicking on input elements, labels, or select elements\n        const target = e.target;\n        if (target instanceof HTMLInputElement || \n            target instanceof HTMLLabelElement || \n            target instanceof HTMLSelectElement) {\n            return;\n        }\n\n        // Don't start dragging if we're connecting or panning\n        if (connecting.from !== null || isPanning) {\n            return;\n        }\n\n        // Set selected layer\n        setSelectedLayerId(id);\n\n        if (!canvasRef.current) return;\n        \n        const layer = layers.find(l => l.id === id);\n        if (!layer) return;\n        \n        const rect = canvasRef.current.getBoundingClientRect();\n        const screenX = e.clientX - rect.left;\n        const screenY = e.clientY - rect.top;\n        const canvasCoords = screenToCanvas(screenX, screenY);\n        \n        // Calculate offset from mouse position to layer's top-left corner\n        const offsetX = canvasCoords.x - layer.x;\n        const offsetY = canvasCoords.y - layer.y;\n        \n        setDraggedId(id);\n        setDragOffset({ x: offsetX, y: offsetY });\n        e.stopPropagation();\n    };\n\n    // Click outside to deselect\n    const handleCanvasClick = (e: React.MouseEvent) => {\n        if (e.target === canvasRef.current) {\n            setSelectedLayerId(null);\n        }\n    };\n\n    const handleMouseUp = () => {\n        setDraggedId(null);\n        setDragOffset({ x: 0, y: 0 });\n        handlePanEnd();\n        \n        // End connection if we're connecting\n        if (connecting.from !== null) {\n            setConnecting({ from: null, to: null });\n            setConnectionPreview(null);\n            setNearbyHandle(null);\n        }\n    };\n\n    const handleMouseMove = (e: React.MouseEvent) => {\n        if (!canvasRef.current) return;\n        \n        const rect = canvasRef.current.getBoundingClientRect();\n        const screenX = e.clientX - rect.left;\n        const screenY = e.clientY - rect.top;\n        const canvasCoords = screenToCanvas(screenX, screenY);\n\n        // Handle panning\n        handlePanMove(e);\n\n        // Handle node dragging\n        if (draggedId !== null && !isPanning) {\n            const x = canvasCoords.x - dragOffset.x;\n            const y = canvasCoords.y - dragOffset.y;\n            setLayers(prev => prev.map(l => l.id === draggedId ? { ...l, x, y } : l));\n        }\n\n        // Handle connection preview\n        if (connecting.from !== null) {\n            const fromLayer = layers.find(l => l.id === connecting.from);\n            if (fromLayer) {\n                const fromPos = getHandlePosition(fromLayer, 'output');\n                const fromScreen = canvasToScreen(fromPos.x, fromPos.y);\n                \n                // Check for nearby input handles\n                let closestHandle: number | null = null;\n                let minDistance = 30; // Snap distance\n                \n                layers.forEach(layer => {\n                    if (layer.id !== connecting.from) {\n                        const inputPos = getHandlePosition(layer, 'input');\n                        const inputScreen = canvasToScreen(inputPos.x, inputPos.y);\n                        const distance = Math.sqrt(\n                            Math.pow(screenX - inputScreen.x, 2) + Math.pow(screenY - inputScreen.y, 2)\n                        );\n                        \n                        if (distance < minDistance) {\n                            minDistance = distance;\n                            closestHandle = layer.id;\n                        }\n                    }\n                });\n                \n                setNearbyHandle(closestHandle);\n                \n                // Set preview line (in screen coordinates for SVG)\n                if (closestHandle) {\n                    const targetLayer = layers.find(l => l.id === closestHandle);\n                    if (targetLayer) {\n                        const targetPos = getHandlePosition(targetLayer, 'input');\n                        const targetScreen = canvasToScreen(targetPos.x, targetPos.y);\n                        setConnectionPreview({\n                            from: fromScreen,\n                            to: targetScreen\n                        });\n                    }\n                } else {\n                    setConnectionPreview({\n                        from: fromScreen,\n                        to: { x: screenX, y: screenY }\n                    });\n                }\n            }\n        }\n    };\n\n    // Inline parameter editing with proper type conversion\n    const handleParamChange = (id: number, param: string, value: string) => {\n        setLayers(prev => prev.map(l => {\n            if (l.id === id) {\n                let convertedValue: any = value;\n                \n                // Convert numeric strings to numbers\n                if (!isNaN(Number(value)) && value.trim() !== '') {\n                    convertedValue = Number(value);\n                }\n                \n                // Handle array inputs (for inputShape, outputShape)\n                if (param.includes('Shape') && typeof value === 'string') {\n                    try {\n                        // Parse comma-separated values as array\n                        convertedValue = value.split(',').map(v => Number(v.trim())).filter(v => !isNaN(v));\n                    } catch {\n                        convertedValue = value;\n                    }\n                }\n                \n                return { ...l, parameters: { ...l.parameters, [param]: convertedValue } };\n            }\n            return l;\n        }));\n    };\n\n    // Handler for ID changes\n    const handleIdChange = (currentId: number, newIdValue: string) => {\n        // Parse the new ID as a number\n        const newId = parseInt(newIdValue);\n        \n        // Validate that the new ID is a valid number and not already used\n        if (isNaN(newId) || newId <= 0) {\n            return; // Invalid ID, don't update\n        }\n        \n        // Check if the new ID is already in use by another layer\n        const existingLayer = layers.find(l => l.id === newId && l.id !== currentId);\n        if (existingLayer) {\n            // ID already exists, could show a warning or auto-generate a unique ID\n            return;\n        }\n        \n        // Update the layer ID\n        setLayers(prev => prev.map(l => \n            l.id === currentId ? { ...l, id: newId } : l\n        ));\n        \n        // Update connections to use the new ID\n        setConnections(prev => prev.map(conn => ({\n            from: conn.from === currentId ? newId : conn.from,\n            to: conn.to === currentId ? newId : conn.to\n        })));\n        \n        // Update selected layer ID if this layer was selected\n        if (selectedLayerId === currentId) {\n            setSelectedLayerId(newId);\n        }\n    };\n\n    // Connection logic with handles\n    const handleConnectionStart = (id: number, type: 'input' | 'output', e: React.MouseEvent) => {\n        console.log('Connection start:', { id, type }); // Debug log\n        e.preventDefault();\n        e.stopPropagation();\n        \n        if (type === 'output') {\n            setConnecting({ from: id, to: null });\n            console.log('Started connecting from node:', id); // Debug log\n        }\n    };\n\n    const handleConnectionEnd = (id: number, type: 'input' | 'output', e: React.MouseEvent) => {\n        console.log('Connection end:', { id, type, connectingFrom: connecting.from }); // Debug log\n        e.preventDefault();\n        e.stopPropagation();\n        \n        if (type === 'input' && connecting.from !== null && connecting.from !== id) {\n            // Check if connection already exists\n            const existingConnectionIndex = connections.findIndex(\n                conn => conn.from === connecting.from && conn.to === id\n            );\n            \n            if (existingConnectionIndex !== -1) {\n                // Disconnect if connection exists\n                console.log('Removing existing connection'); // Debug log\n                setConnections(prev => prev.filter((_, index) => index !== existingConnectionIndex));\n            } else {\n                // Connect if no connection exists\n                console.log('Creating new connection from', connecting.from, 'to', id); // Debug log\n                const fromId: number = connecting.from;\n                setConnections(prev => [...prev, { from: fromId, to: id }]);\n            }\n        }\n        \n        // Always clear connection state\n        setConnecting({ from: null, to: null });\n        setConnectionPreview(null);\n        setNearbyHandle(null);\n    };\n\n    // Function to get all model data for export\n    const getModelData = () => {\n        return {\n            layers: layers.map(layer => ({\n                id: layer.id,\n                type: layer.type,\n                parameters: layer.parameters,\n                position: { x: layer.x, y: layer.y }\n            })),\n            connections: connections.map(connection => ({\n                from: connection.from,\n                to: connection.to\n            }))\n        };\n    };\n    \n    // Expose the getModelData function via ref\n    React.useImperativeHandle(ref, () => ({\n        getModelData\n    }));\n    \n    // Function to update node width after render - optimized to prevent infinite loops\n    const updateNodeWidth = useCallback((layerId: number, element: HTMLDivElement | null) => {\n        if (element) {\n            const currentWidth = element.offsetWidth;\n            \n            // Only update if width has actually changed\n            setLayers(prev => {\n                const existingLayer = prev.find(layer => layer.id === layerId);\n                if (existingLayer && existingLayer.width !== currentWidth) {\n                    return prev.map(layer => \n                        layer.id === layerId \n                            ? { ...layer, width: currentWidth }\n                            : layer\n                    );\n                }\n                return prev;\n            });\n        }\n    }, []);\n\n    // Use useEffect to measure width after initial render instead of ref callback\n    useEffect(() => {\n        layers.forEach(layer => {\n            if (!layer.width) {\n                const element = document.querySelector(`[data-layer-id=\"${layer.id}\"]`);\n                if (element && element instanceof HTMLDivElement) {\n                    const width = element.offsetWidth;\n                    setLayers(prev => prev.map(l => \n                        l.id === layer.id ? { ...l, width } : l\n                    ));\n                }\n            }\n        });\n    }, [layers.length]); // Only run when number of layers changes\n\n    // Helper function to get handle positions - using actual width\n    const getHandlePosition = (layer: DroppedLayer, type: 'input' | 'output') => {\n        if (type === 'input') {\n            return {\n                x: layer.x - 8,\n                y: layer.y + 50\n            };\n        } else {\n            const nodeWidth = layer.width || 270;\n            return {\n                x: layer.x + nodeWidth + 8,\n                y: layer.y + 50\n            };\n        }\n    };\n\n    // Update connection line positions to connect handles\n    const getLayerCenter = (layer: DroppedLayer) => {\n        return {\n            x: layer.x + 60,\n            y: layer.y + 50\n        };\n    };\n\n    // Updated render connections to use screen coordinates\n    const renderConnections = () => {\n        const connectionLines = connections.map((connection, index) => {\n            const fromLayer = layers.find(l => l.id === connection.from);\n            const toLayer = layers.find(l => l.id === connection.to);\n            \n            if (!fromLayer || !toLayer) return null;\n            \n            const from = getHandlePosition(fromLayer, 'output');\n            const to = getHandlePosition(toLayer, 'input');\n            const fromScreen = canvasToScreen(from.x, from.y);\n            const toScreen = canvasToScreen(to.x, to.y);\n            \n            return (\n                <line\n                    key={`connection-${index}`}\n                    x1={fromScreen.x}\n                    y1={fromScreen.y}\n                    x2={toScreen.x}\n                    y2={toScreen.y}\n                    stroke=\"#007acc\"\n                    strokeWidth={2}\n                    markerEnd=\"url(#arrowhead)\"\n                />\n            );\n        });\n\n        // Add preview connection\n        const previewLine = connectionPreview && (\n            <line\n                key=\"preview\"\n                x1={connectionPreview.from.x}\n                y1={connectionPreview.from.y}\n                x2={connectionPreview.to.x}\n                y2={connectionPreview.to.y}\n                stroke={nearbyHandle ? \"#4caf50\" : \"#ffa726\"}\n                strokeWidth={2}\n                strokeDasharray=\"5,5\"\n                markerEnd=\"url(#previewArrowhead)\"\n            />\n        );\n\n        return (\n            <svg\n                style={{\n                    position: 'absolute',\n                    top: 0,\n                    left: 0,\n                    width: '100%',\n                    height: '100%',\n                    pointerEvents: 'none',\n                    zIndex: 15 // Higher than canvas content but lower than handles\n                }}\n            >\n                <defs>\n                    <marker\n                        id=\"arrowhead\"\n                        markerWidth=\"10\"\n                        markerHeight=\"7\"\n                        refX=\"9\"\n                        refY=\"3.5\"\n                        orient=\"auto\"\n                    >\n                        <polygon\n                            points=\"0 0, 10 3.5, 0 7\"\n                            fill=\"#007acc\"\n                        />\n                    </marker>\n                    <marker\n                        id=\"previewArrowhead\"\n                        markerWidth=\"10\"\n                        markerHeight=\"7\"\n                        refX=\"9\"\n                        refY=\"3.5\"\n                        orient=\"auto\"\n                    >\n                        <polygon\n                            points=\"0 0, 10 3.5, 0 7\"\n                            fill={nearbyHandle ? \"#4caf50\" : \"#ffa726\"}\n                        />\n                    </marker>\n                </defs>\n                {connectionLines}\n                {previewLine}\n            </svg>\n        );\n    };\n\n    return (\n        <div\n            className=\"canvas\"\n            ref={canvasRef}\n            style={{ \n                height: '100%',\n                width: '100%',\n                border: '1px solid rgba(255, 255, 255, 0.03)', \n                position: 'relative', \n                overflow: 'hidden',\n                background: `\n                    linear-gradient(135deg, #0a0a10 0%, #12121a 100%)\n                    repeating-linear-gradient(rgba(255, 255, 255, 0.02) 0px, rgba(255, 255, 255, 0.02) 1px, transparent 1px, transparent 20px),\n                    repeating-linear-gradient(90deg, rgba(255, 255, 255, 0.02) 0px, rgba(255, 255, 255, 0.02) 1px, transparent 1px, transparent 20px)\n                `,\n                backgroundSize: `\n                    100% 100%,\n                    20px 20px,\n                    20px 20px\n                `,\n                cursor: isPanning ? 'grabbing' : connecting.from !== null ? 'crosshair' : 'default',\n                boxShadow: 'inset 0 0 50px rgba(0, 0, 0, 0.4)'\n            }}\n            onWheel={handleWheel}\n            onMouseDown={handlePanStart}\n            onMouseMove={handleMouseMove}\n            onMouseUp={handleMouseUp}\n            onClick={handleCanvasClick}\n            onDragOver={(e) => e.preventDefault()}\n            onDrop={(e) => {\n                e.preventDefault();\n                try {\n                    const data = e.dataTransfer.getData('text/plain');\n                    const layer = JSON.parse(data);\n                    \n                    // Calculate drop position relative to canvas\n                    const rect = canvasRef.current?.getBoundingClientRect();\n                    if (rect) {\n                        const x = e.clientX - rect.left;\n                        const y = e.clientY - rect.top;\n                        \n                        handleDrop({\n                            ...layer,\n                            x: x - 60,\n                            y: y - 50\n                        });\n                    }\n                } catch (error) {\n                    console.error('Failed to parse dropped data:', error);\n                }\n            }}\n            tabIndex={0}\n        >\n            {/* Zoom controls */}\n            <div style={{\n                position: 'absolute',\n                top: 10,\n                right: 10,\n                zIndex: 200,\n                display: 'flex',\n                flexDirection: 'column',\n                gap: 5,\n                background: 'linear-gradient(135deg, #12121a 0%, #1a1a24 100%)',\n                padding: 8,\n                borderRadius: 10,\n                border: '1px solid rgba(255, 255, 255, 0.05)',\n                boxShadow: '0 2px 15px rgba(0, 0, 0, 0.4)'\n            }}>\n                <button\n                    onClick={() => setCanvasTransform(prev => ({ ...prev, scale: Math.min(3, prev.scale * 1.2) }))}\n                    style={{\n                        background: 'linear-gradient(135deg, #2a4d7a 0%, #3d5a7a 100%)',\n                        border: 'none',\n                        color: '#fff',\n                        padding: '6px 10px',\n                        borderRadius: 6,\n                        cursor: 'pointer',\n                        fontWeight: 'bold'\n                    }}\n                >\n                    +\n                </button>\n                <button\n                    onClick={() => setCanvasTransform(prev => ({ ...prev, scale: Math.max(0.1, prev.scale / 1.2) }))}\n                    style={{\n                        background: 'linear-gradient(135deg, #2a4d7a 0%, #3d5a7a 100%)',\n                        border: 'none',\n                        color: '#fff',\n                        padding: '6px 10px',\n                        borderRadius: 6,\n                        cursor: 'pointer',\n                        fontWeight: 'bold'\n                    }}\n                >\n                    -\n                </button>\n                <button\n                    onClick={resetTransform}\n                    style={{\n                        background: 'rgba(255, 255, 255, 0.05)',\n                        border: 'none',\n                        color: '#fff',\n                        padding: '6px 10px',\n                        borderRadius: 6,\n                        cursor: 'pointer',\n                        fontSize: 10\n                    }}\n                >\n                    Reset\n                </button>\n                <div style={{ \n                    color: '#fff', \n                    fontSize: 10, \n                    textAlign: 'center',\n                    padding: '4px 0',\n                    background: 'rgba(255, 255, 255, 0.05)',\n                    borderRadius: 6\n                }}>\n                    {Math.round(canvasTransform.scale * 100)}%\n                </div>\n            </div>\n\n            {/* Help text */}\n            <div style={{\n                position: 'absolute',\n                bottom: 10,\n                left: 10,\n                color: '#b0b8c4',\n                fontSize: 11,\n                background: 'linear-gradient(135deg, rgba(18, 18, 26, 0.8) 0%, rgba(30, 30, 45, 0.8) 100%)',\n                padding: '8px 12px',\n                borderRadius: 8,\n                zIndex: 200,\n                backdropFilter: 'blur(5px)',\n                boxShadow: '0 2px 10px rgba(0, 0, 0, 0.4)',\n                border: '1px solid rgba(255, 255, 255, 0.05)'\n            }}>\n                Scroll to zoom  Ctrl+Click or Middle-click to pan<br/>\n                Click red dot then green dot to connect nodes\n            </div>\n\n            {/* Canvas content with transform */}\n            <div\n                ref={contentRef}\n                style={{\n                    transform: `translate(${canvasTransform.x}px, ${canvasTransform.y}px) scale(${canvasTransform.scale})`,\n                    transformOrigin: '0 0',\n                    position: 'absolute',\n                    width: '100%',\n                    height: '100%',\n                    zIndex: 10,\n                    pointerEvents: 'auto',\n                    backgroundImage: `\n                        linear-gradient(rgba(255, 255, 255, 0.01) 1px, transparent 1px),\n                        linear-gradient(90deg, rgba(255, 255, 255, 0.01) 1px, transparent 1px)\n                    `,\n                    backgroundSize: '20px 20px',\n                    backgroundPosition: '0 0'\n                }}\n            >\n                {/* Render blocks */}\n                {layers.map((layer) => {\n                    const LayerComponent = layerComponentMap[layer.type];\n                    if (!LayerComponent) return null;\n                    \n                    const isSelected = selectedLayerId === layer.id;\n                    const isConnecting = connecting.from === layer.id;\n                    const isNearbyTarget = nearbyHandle === layer.id;\n                    \n                    // Get gradient based on layer type\n                    const getLayerGradient = (type: LayerType) => {\n                        const gradients: Record<LayerType, string> = {\n                            InputLayer: 'linear-gradient(135deg, #2a8db8 0%, #4a6fa5 100%)',\n                            Conv2DLayer: 'linear-gradient(135deg, #7a3d00 0%, #7a2a4d 100%)',\n                            OutputLayer: 'linear-gradient(135deg, #005a7a 0%, #00477a 100%)',\n                            ConcatLayer: 'linear-gradient(135deg, #4d2a5a 0%, #5a2a5a 100%)',\n                            LinearLayer: 'linear-gradient(135deg, #2a4d7a 0%, #4a5a7a 100%)',\n                            FlattenLayer: 'linear-gradient(135deg, #7a2a0f 0%, #7a2a2a 100%)',\n                            MaxPoolLayer: 'linear-gradient(135deg, #0f5e5e 0%, #1a7a7a 100%)'\n                        };\n                        return gradients[type] || 'linear-gradient(135deg, #333 0%, #555 100%)';\n                    };\n                    \n                    // Inline parameter editing UI for demo\n                    const paramInputs = Object.keys(layer.parameters)\n    .filter(param => !['activation', 'activationFunction'].includes(param))\n    .map(param => {\n    const value = layer.parameters[param];\n    const displayValue = Array.isArray(value) ? value.join(', ') : String(value);\n    \n    return (\n                            <div key={param} style={{ marginBottom: 8 }}>\n                                <label style={{ fontSize: 12, color: '#b0b8c4', fontWeight: 500 }}>{param}: </label>\n                                <input\n                                    style={{ \n                                        fontSize: 12, \n                                        width: 90,\n                                        backgroundColor: 'rgba(255, 255, 255, 0.05)',\n                                        border: '1px solid rgba(255, 255, 255, 0.1)',\n                                        color: '#ffffff',\n                                        padding: '4px 8px',\n                                        borderRadius: '6px',\n                                        outline: 'none'\n                                    }}\n                                    value={displayValue}\n                                    onChange={e => handleParamChange(layer.id, param, e.target.value)}\n                                    placeholder={param.includes('Shape') ? \"e.g. 28, 28, 1\" : \"\"}\n                                    onMouseDown={(e) => e.stopPropagation()}\n                                    onFocus={(e) => e.stopPropagation()}\n                                />\n                            </div>\n                        );\n                    });\n                    \n                    return (\n                        <div key={layer.id}>\n                            {/* Input Handle */}\n                            <div\n                                style={{\n                                    position: 'absolute',\n                                    left: layer.x - 8,\n                                    top: layer.y + 42,\n                                    width: 16,\n                                    height: 16,\n                                    background: isNearbyTarget \n                                        ? 'linear-gradient(135deg, #1a4d4d 0%, #2a5a2a 100%)' \n                                        : 'linear-gradient(135deg, #0f5e5e 0%, #1a7a7a 100%)',\n                                    borderRadius: '50%',\n                                    border: '2px solid #ffffff',\n                                    cursor: 'pointer',\n                                    zIndex: 100,\n                                    boxShadow: isNearbyTarget \n                                        ? '0 0 12px rgba(26, 77, 77, 0.8)' \n                                        : '0 2px 8px rgba(0, 0, 0, 0.5)',\n                                    transform: isNearbyTarget ? 'scale(1.2)' : 'scale(1)',\n                                    transition: 'all 0.2s ease',\n                                    pointerEvents: 'auto'\n                                }}\n                                onMouseDown={(e) => {\n                                    console.log('Input handle mouse down'); // Debug log\n                                    handleConnectionStart(layer.id, 'input', e);\n                                }}\n                                onMouseUp={(e) => {\n                                    console.log('Input handle mouse up'); // Debug log\n                                    handleConnectionEnd(layer.id, 'input', e);\n                                }}\n                                onClick={(e) => {\n                                    console.log('Input handle clicked'); // Debug log\n                                    e.preventDefault();\n                                    e.stopPropagation();\n                                }}\n                                title=\"Input - Click to connect from another node's output\"\n                            />\n                            \n                            {/* Main Node */}\n                            <div\n                                data-layer-id={layer.id}\n                                style={{\n                                    position: 'absolute',\n                                    left: layer.x,\n                                    top: layer.y,\n                                    background: isConnecting \n                                        ? 'linear-gradient(135deg, #0a0a0f 0%, #1a1a24 100%)' \n                                        : isSelected \n                                            ? 'linear-gradient(135deg, #1a1a2e 0%, #242438 100%)'\n                                            : 'linear-gradient(135deg, #161620 0%, #1a1a24 100%)',\n                                    border: isConnecting \n                                        ? `2px solid ${getLayerGradient(layer.type)}` \n                                        : isSelected \n                                            ? '2px solid #5a5a6b' \n                                            : '1px solid rgba(255, 255, 255, 0.05)',\n                                    borderRadius: 12,\n                                    padding: 16,\n                                    minWidth: 120,\n                                    cursor: connecting.from !== null ? 'crosshair' : isPanning ? 'grabbing' : 'move',\n                                    zIndex: draggedId === layer.id ? 80 : 30,\n                                    color: '#ffffff',\n                                    boxShadow: isSelected \n                                        ? '0 0 20px rgba(90, 90, 107, 0.3)' \n                                        : '0 4px 20px rgba(0, 0, 0, 0.4)',\n                                    userSelect: 'none',\n                                    WebkitUserSelect: 'none',\n                                    MozUserSelect: 'none',\n                                    msUserSelect: 'none',\n                                    pointerEvents: 'auto',\n                                    backdropFilter: 'blur(5px)'\n                                }}\n                                onMouseDown={e => handleMouseDown(layer.id, e)}\n                            >\n                                {/* Subtle indicator of layer type at the top */}\n                                <div style={{\n                                    height: '4px',\n                                    background: getLayerGradient(layer.type),\n                                    borderRadius: '10px',\n                                    marginBottom: '10px',\n                                    opacity: 0.8\n                                }}></div>\n                                \n                                <LayerComponent {...layer.parameters} />\n                                \n                                {/* Layer Properties Section */}\n                                <div style={{ marginTop: 12, userSelect: 'none' }}>\n                                    {/* Layer ID Input */}\n                                    <div style={{ marginBottom: 8 }}>\n                                        <label style={{ \n                                            fontSize: 12, \n                                            color: '#ffa726', \n                                            fontWeight: 600,\n                                            textShadow: '0 1px 2px rgba(0, 0, 0, 0.3)'\n                                        }}>\n                                            ID: \n                                        </label>\n                                        <input\n                                            type=\"number\"\n                                            style={{ \n                                                fontSize: 12, \n                                                width: 90,\n                                                backgroundColor: 'rgba(255, 167, 38, 0.1)',\n                                                border: '1px solid rgba(255, 167, 38, 0.3)',\n                                                color: '#ffa726',\n                                                padding: '4px 8px',\n                                                borderRadius: '6px',\n                                                outline: 'none',\n                                                fontWeight: 600\n                                            }}\n                                            value={layer.id}\n                                            onChange={e => handleIdChange(layer.id, e.target.value)}\n                                            onMouseDown={(e) => e.stopPropagation()}\n                                            onFocus={(e) => e.stopPropagation()}\n                                            min=\"1\"\n                                            title=\"Layer unique identifier\"\n                                        />\n                                    </div>\n                                    \n                                    {/* Other Parameters */}\n                                    {paramInputs}\n                                </div>\n                            </div>\n                            \n                            {/* Output Handle */}\n                            <div\n                                style={{\n                                    position: 'absolute',\n                                    left: layer.x + (layer.width || 270) + 8,\n                                    top: layer.y + 42,\n                                    width: 16,\n                                    height: 16,\n                                    background: 'linear-gradient(135deg, #7a2a2a 0%, #5a1a1a 100%)',\n                                    borderRadius: '50%',\n                                    border: '2px solid #ffffff',\n                                    cursor: 'pointer',\n                                    zIndex: 100,\n                                    boxShadow: connecting.from === layer.id \n                                        ? '0 0 12px rgba(122, 42, 42, 0.8)' \n                                        : '0 2px 8px rgba(0, 0, 0, 0.5)',\n                                    transform: connecting.from === layer.id ? 'scale(1.2)' : 'scale(1)',\n                                    transition: 'all 0.2s ease',\n                                    pointerEvents: 'auto'\n                                }}\n                                onMouseDown={(e) => {\n                                    console.log('Output handle mouse down'); // Debug log\n                                    handleConnectionStart(layer.id, 'output', e);\n                                }}\n                                onMouseUp={(e) => {\n                                    console.log('Output handle mouse up'); // Debug log\n                                    handleConnectionEnd(layer.id, 'output', e);\n                                }}\n                                onClick={(e) => {\n                                    console.log('Output handle clicked'); // Debug log\n                                    e.preventDefault();\n                                    e.stopPropagation();\n                                }}\n                                title=\"Output - Click and drag to connect to another node's output\"\n                            />\n                        </div>\n                    );\n                })}\n            </div>\n\n            {/* Render connection lines */}\n            {renderConnections()}\n        </div>\n    );\n});\n\nexport default Canvas;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}